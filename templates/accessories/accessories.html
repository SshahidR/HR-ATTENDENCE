{% extends "base_sale.html" %}
{% load static %}
{% block content %}

<style>
    .suwala-doubleScroll-scroll-wrapper{
        width: 100% !important;
    }
    
    
    #sp_products td{
        padding: 1px;
        margin: 0px;
    }

#products > tbody > tr > td:nth-child(9) {
    background-color: lightgreen !important;
}

/*#sp_products > tbody > tr > td:nth-child(9) {
    background-color: lightgreen !important;
}

#sp_products > tbody > tr > td:nth-child(1) {
    contenteditable: true;
}*/

/* approver history workflow */
#search-tbl{


    text-align: center;

}


.popover-header{


    background: rgb(255, 214, 204);
    color: black;


}


#blink-bg{
		color: #fff;
		padding: 10px;
		display: inline-block;
		border-radius: 5px;
		animation: blinkingBackground 2s infinite;
	}
	@keyframes blinkingBackground{
		0%		{ background-color: #10c018;}
		25%		{ background-color: #1056c0;}
		50%		{ background-color: #ef0a1a;}
		75%		{ background-color: #254878;}
		100%	        { background-color: #04a1d5;}
	}


#customer_receipt
{
  /*   height: 250px;
    overflow: scroll;
 */
}
body {
    background-color: #eee
}

.mt-70 {
    margin-top: 70px
}

.mb-70 {
    margin-bottom: 70px
}

.card {
    box-shadow: 0 0.46875rem 2.1875rem rgba(4, 9, 20, 0.03), 0 0.9375rem 1.40625rem rgba(4, 9, 20, 0.03), 0 0.25rem 0.53125rem rgba(4, 9, 20, 0.05), 0 0.125rem 0.1875rem rgba(4, 9, 20, 0.03);
    border-width: 0;
    transition: all .2s
}

.card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 1px solid rgba(26, 54, 126, 0.125);
    border-radius: .25rem
}

.card-body {
    flex: 1 1 auto;
    padding: 1.25rem
}

.vertical-timeline {
    width: 100%;
    position: relative;
    padding: 1.5rem 0 1rem
}

.vertical-timeline::before {
    content: '';
    position: absolute;
    top: 0;
    left: 26%;
    height: 100%;
    width: 4px;
    background: #e9ecef;
    border-radius: .25rem
}

.vertical-timeline-element {
    position: relative;
    margin: 0 0 1rem
}

.vertical-timeline--animate .vertical-timeline-element-icon.bounce-in {
    visibility: visible;
    animation: cd-bounce-1 .8s
}

.vertical-timeline-element-icon {
    position: absolute;
    top: 0;
    left: 60px
}

.vertical-timeline-element-icon .badge-dot-xl {
    box-shadow: 0 0 0 5px #fff
}

.badge-dot-xl {
    width: 18px;
    height: 18px;
    position: relative
}

.badge:empty {
    display: none
}

.badge-dot-xl::before {
    content: '';
    width: 10px;
    height: 10px;
    border-radius: .25rem;
    position: absolute;
    left: 50%;
    top: 50%;
    margin: -5px 0 0 -5px;
    background: #fff
}

.vertical-timeline-element-content {
    position: relative;
    margin-left: 27%;
    font-size: .8rem
}

.vertical-timeline-element-content .timeline-title {
    font-size: .8rem;
    text-transform: uppercase;
    margin: 0 0 .5rem;
    padding: 2px 0 0;
    font-weight: bold
}

.vertical-timeline-element-content .vertical-timeline-element-date {
    display: block;
    position: absolute;
    left: -25%;
    top: 0;
    /* padding-right: 10px; */
    text-align: right;
    /* color: #adb5bd; */
    font-size: .7619rem;
    white-space: nowrap;

    border-radius: 4px;
    background-color: #007bff;
    display: inline-block;
    font-weight: 600;
    color: white;
    padding: 5px;
}

.vertical-timeline-element-content:after {
    content: "";
    display: table;
    clear: both
}




</style>








<style>

.plus-item{

display: none;

}
.minus-item{

display: none;

}

.table-sm td {
  
    text-align: center;
}



.select2-results__option[aria-selected] {
   
    background: #c1c1c1; 
}

select2-container--default .select2-results__option--highlighted[aria-selected] {
    background-color: #909090;
    color: white;
}

/* .select2-results{

    width: 226%;
    float: right;

} */

.right, .entered_price{

    text-align: right;
}

.total{
    font-weight: bold;
}

#search-tbl_filter > label{

    font-weight: bold;
}



/* table#datagrid td:nth-child(9) {
   display: none;
} */
/* table#datagrid th:nth-child(9) {
   display: none;
} */




/* table#datagrid td:nth-child(15) {
   display: none;
}
table#datagrid th:nth-child(15) {
   display: none;
} */


/* table#datagrid td:nth-child(10) {
   display: none;
}
table#datagrid th:nth-child(10) {
   display: none;
} */

/* table#datagrid td:nth-child(11) {
   display: none;
}
table#datagrid th:nth-child(11) {
   display: none;
} */

/* table#datagrid td:nth-child(12) {
   display: none;
}
table#datagrid th:nth-child(12) {
   display: none;
} */

/* table#datagrid td:nth-child(14) {
   display: none;
}
table#datagrid th:nth-child(14) {
   display: none;
} */

@-webkit-keyframes blink {
    50% {
        color: darkred;
        background: white
    }
}
@-moz-keyframes blink {
    50% {
        color:darkred;
        background: white
    }
}
@keyframes blink {
    50% {
        color: darkred;
        background: white
    }
}
.blink {
    -webkit-animation-direction: normal;
    -webkit-animation-duration: 5s;
    -webkit-animation-iteration-count: infinite;
    -webkit-animation-name: blink;
    -webkit-animation-timing-function: linear;
    -moz-animation-direction: normal;
    -moz-animation-duration: 5s;
    -moz-animation-iteration-count: infinite;
    -moz-animation-name: blink;
    -moz-animation-timing-function: linear;
    animation-direction: normal;
    animation-duration: 5s;
    animation-iteration-count: infinite;
    animation-name: blink;
    animation-timing-function: linear;
}



#show-cart td, .table-sm th {
   
    border: 1px solid #17a2b861;
}

#show-cart > thead > tr > td{

font-weight: bold;

}
#dept_line{
        
        
        }
.badge{
    padding: 4px;

}
   .dt-button {
    padding: .25rem .5rem;
    font-size: .875rem;
    line-height: 1.5;
    border-radius: .2rem;
    color: #fff;
    background-color: #007bff;
    border-color: #007bff;
    box-shadow: none;
    }
#products_wrapper > div:nth-child(2) > div
{
    overflow: hidden;
    overflow-y: scroll !important;
    height: 300px !important;
}
#products > thead
{
    position: sticky;
    top: 0px;
    background: white;
}

#sp_products_wrapper > div:nth-child(2) > div
{
    overflow: hidden;
    overflow-y: scroll !important;
    height: 300px !important;
}
#sp_products > thead
{
    position: sticky;
    top: 0px;
    background: white;
}


#search-tbl > tfoot > tr > th > input[type=text]
{

    width: 100%;

}
.tbl_font
{
    font-size:14px;
}

.row-checkbox
{
    zoom: 1.8;
    margin-top: 2px;
    
}
.dataframe{
  
    width: 100%;

}
/* @-webkit-keyframes argh-my-eyes {
    0%   { background-color: #ffdddd !important; }
    49% { background-color: #e4aaaa !important }
    50% { background-color: rgb(255, 255, 255); }
    99% { background-color: rgb(197, 80, 80); }
    100% { background-color: #fff; }
  } */
  /* @-moz-keyframes argh-my-eyes {
    0%   { background-color: #ffdddd !important; }
    49% { background-color: #e4aaaa !important }
    50% { background-color: rgb(255, 255, 255); }
    99% { background-color: #a29c9c; }
    100% { background-color: #fff; }
  } */
  @keyframes argh-my-eyes {
    0%   { background-color: #ffdddd !important; }
    49% { background-color: #e4aaaa !important }
    50% { background-color: rgb(255, 255, 255); }
    99% { background-color: #a29c9c;  }
    100% { background-color: #fff; }
  }
  .forty_eight
{
  -webkit-animation: argh-my-eyes 1s infinite;
  -moz-animation:    argh-my-eyes 1s infinite;
  animation:         argh-my-eyes 5s infinite;
  /*background-color: #ffdddd !important*/
}
.tw_four
{
    /* background-color: #ca2424 !important */
    color: red;
}
tfoot 
{
    display: table-header-group;
}

</style>

<script>
function los_modal_s(thizz)
{
    $('#los_modal').modal('show');
}

document.addEventListener('DOMContentLoaded', function(event) {
  
$('#los_modal').on('shown.bs.modal', function (e) {
    //alert("I want this to appear after the modal has opened!");
    initSelect2();
})

})




function initSelect2()
{
            $('select.form-control.wotags').select2({
                    placeholder:' - Select -',
                    dropdownAutoWidth : true,
                    // tags: true,
                    allowClear: true,
                    // minimumResultsForSearch: Infinity,
                    minimumInputLength: 0,
                    language: {
                        inputTooShort: $('<div>Please select </div>')
                    },
                    ajax: {
                        url: "",
                        dataType: 'json',
                        delay: 250,
                        beforeSend:function(xhr,settings){
                            if (!this.crossDomain) {
                                xhr.setRequestHeader("X-CSRFToken", "{{csrf_token}}");
                                }
                        },
                        data: function (params) {
                            if ( $('.select2-results').find('.search-loader').length == 0){
                                $('.select2-results').append('<div class="d-flex search-loader justify-content-center p-2">\
                                <div class="spinner-grow text-info" role="status"><span class="sr-only">Loading...</span></div></div>');
                            }
                            console.log(this);
                            return {
                                q: params.term, // search term
                                page: params.page,
                                select_name:this.attr('name'),
                                defs:localStorage.getItem('defs')

                            };
                    },
                    processResults: function (data, params) {
                            $('.search-loader').remove();
                            params.page = params.page || 1;
        
                            // console.log(this);
        
                            return {
                                results: data.items,
                                pagination: {
                                    more: (params.page * 30) < data.total_count
                                }
                            };
                        },
                        cache: true
                    },
                    // templateSelection: function (data, container) {
                    //     Object.keys(data).forEach(function (key) {
                    //         $(data.element).attr('data-'+key, data[key]);  
                    //     })
                    //     return data.text;
                    // }
        
                });
        }

function insertlos()
{
            ShowDIV()

        var u_full_name=$('#u_full_name').html();
        
        $('#create_los').prop('disabled', true);

        var organization_name=JSON.parse(localStorage.getItem('defs'))['organization_name'];

        try 
        {
            var main_customner_name=$('#searchCust').select2('data')[0]['customer_name'];

            var main_customer_number=$('#searchCust').select2('data')[0]['customer_number'];

            var email_address =$('#searchCust').select2('data')[0]['email_address']

           var additional_mobile_no=  $('#searchCust').select2('data')[0]['additional_mobile_no']

        } 
        catch (error) 
        {
                console.log(error);
                alert('Please select a customer');
                HideDIV()
                return ;
                // expected output: ReferenceError: nonExistentFunction is not defined
                // Note - error messages will vary depending on browser
        }

        var data = $('.wotags').select2('data')
        var los_reason=data[0].text;

        var remarks =$('#remakrs_').val()

        var qty =1
        var cart= JSON.stringify(shoppingCart.listCart());
        
        
        axios.defaults.xsrfHeaderName = "X-CSRFTOKEN";
        axios.defaults.xsrfCookieName = "csrftoken";
        axios.defaults.withCredentials = true;
        axios.post('submit-los', 
        {
            staffname: u_full_name,
            organization_name: organization_name,
            main_customner_name:main_customner_name,
            main_customer_number:main_customer_number,
            los_reason:los_reason,
            remarks:remarks,   
            cart:cart  ,
            email_address:email_address,
            additional_mobile_no:additional_mobile_no      
        })
        .then(function (response) 
        {
            console.log(response);
            toastr.success(response.data.message);
            $('#los_modal').modal('hide');
            HideDIV()
            toastr.success(response.id)




        })


            //var data = parseForm('#lossofsale-form');
           // var custphone =  data.filter(x => x.name == 'custphone')[0].value;
            //if (custphone == "" || custphone.trim().length <10)
           // {
            //    return toastr.error("Please enter a valid phone number ");
           // }

           // var data = parseForm('#lossofsale-form')
            // axios.post('submit-los',{
        // staffname: u_full_name,
        // organization_name: organization_name,
        // main_customner_name:main_customner_name,
        // main_customer_number:main_customer_number,
        // los_reason:los_reason,
        // remarks:remarks,
        // qty:qty                
            //     })
            // .then(function (response) 
            // {
            //     if (response.data.flag == 'S')
            //     {
                   // toastr.success(response.data.message);
                   // $('#lossofsale-form [type="reset"]').click();
                   // window.location.href="/lossofsale/losdetails/"+window.location.search;
                // }
                // else if(response.data.flag == 'E')
                // {
                //     //toastr.error(response.data.message);
                // }
            // })
            // .catch(function(error)
            // {
            //     toastr.error(error.response.data);
            // })
       



}

</script>


<div class="modal" tabindex="-1" role="dialog" id="los_modal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          
        <div class="row">
            <div class="col-12">
                <div class="form-group">
                    <label class="control-label col-form-label">Reason for Loss of Sale <span style="color: red;">*</span></label>
                    <select class="select wotags form-control form-control-sm text dyn-fld" type="text" style="width:100%" required><option></option> 
                    </select>
                </div>
            </div>



            <div class="col-12">
                <div class="form-group">
                    <label for="remarks" class="control-label col-form-label">Remarks <span style="color: red;">*</span></label>
                    <textarea class="form-control dyn-fld" id="remakrs_" rows="3" placeholder="Remarks"></textarea>
                </div>
            </div>


        </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="insertlos()">Submit</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <button type="button" class="btn btn-info" onclick="cancelScan()" id="cancelScan" style="display: none;">Cancel Scan</button>
  <div style="width: 100% height:100%" id="reader">
</div>


<!-- The Modal -->
<div id="v-dash">

    <!-- <div class="modal  fade modal-small in" id="pdi_req_modal" role="dialog">
        <div class="modal-dialog modal-lg" style="    max-width: 86% !important;">
          <div class="modal-content">      
           
            <div class="modal-header">
              <h4 class="modal-title" style="font-weight: 800;">PDI   ( <span id="order_n">  </span>) <input type="hidden" id="order_id"  /></h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            
           
            <div class="modal-body" style="    padding-left: 3%;
            padding-right: 3%;
            margin-bottom: 4%;
            margin-top: 1%;">
            <div id="process_type">
                
            </div> 

            <div id="header_v2">
                
            </div>   

    
              <p>* select lines and then click on save button to create a PDI request</p>
            <div class="table-responsive-sm">
                  
                  <table id="pdi_main_tbl" class="table table-sm  table-hover table-responsive" style="white-space: nowrap;">
                    <thead>
                        <tr>
                      
                        <th></th>
                        <th class="text-center" >SR </th>
                        <th  class="text-center">PDI Number</th>
                        <th  class="text-center">Item Name</th>
                        <th  class="text-center">Item Description</th>

                        <th  class="text-center">Mfg Code</th>
                        <th  class="text-center">UOM</th>
                        <th  class="text-center">Qty</th>
                        <th  class="text-center">Color</th>
                        <th  class="text-center">Year</th>
                        <th  class="text-center">Source</th>
                        <th  class="text-center">PDI Location</th>

                        <th  class="text-center">Serial</th>
                        <th  class="text-center">Required Date</th>
                        <th  class="text-center">From Subinventry</th>
                        <th  class="text-center">Job Card</th>


                        <th  class="text-center">To Subinventry</th>
                        <th  class="text-center">Header Status</th>
                        <th  class="text-center">Line Status</th>
                        <th  class="text-center">PDI Value</th>
                        <th  class="text-center">Delivery Number</th>
                        <th  class="text-center">Workshop Delivery</th> 
                        <th  class="text-center">Return Reason</th>    
                        <th  class="text-center">PDI Activities</th>                                 
                      </tr>
                    </thead>
                    <tbody>
                         
                      <tr v-for="(row,index)  in ret_line_data">    
                          <td    ><input    v-if="row['doc_number']==''"    type="checkbox" /></td>                    
                        <td>[[row.line_number]]</td>
                        <td>[[row.doc_number]]   </td>
                       
                      

                        <td>[[row.item_code]] <br>  <input type="hidden"  v-bind:value="row.order_header"    id="custom_table_oder_number" /></td>
                        <td>[[row.item_code]] <br>  <input type="hidden"  v-bind:value="row.order_header"    id="custom_table_oder_number" /></td>
                      
                            <td>[[row.mfg_code]]</td>
                            <td>[[row.primary_uom_code]]</td>
                            <td >[[row.ordered_qty]]</td>  
                            <td >[[row.color]]</td>  
                            <td >[[row.year]]</td>  
                            <td >[[row.stock_location]]</td> 

                            <td>                              

                                <select    v-if="row['doc_number']==''"        class="form-control" :required="true"  style="    width: 234px;">
                                    <option  v-for="option in ret_line_reason_lov"   v-bind:value="option.lookup_code" > [[option.meaning ]]</option>
                                </select>

                               <span   v-if="row['doc_number']!=''" >[[row.pdi_loc]]</span>

                            </td>
                            <td >[[row.vin_number]]</td>
                            <td><input  v-if="row['doc_number']==''"        v-bind:id="row.line_number"  v-bind:value="row.delivery_date"   type="txt"  />
                                <input  v-if="row['doc_number']!=''" disabled   v-bind:value="row.delivery_date"   type="txt"  />
                            
                            </td>

                            <td>  [[row.subinventory]]</td>
                            <td></td>
                            <td>  [[row.subinventory]]</td>
                            <td> [[row.header_status]]</td>
                            <td> [[row.line_status]]</td>                           
                            <td></td>
                            <td></td>
                            <td></td>
                           
                            
                           
                        <td>
                            <input type="hidden"  v-bind:value="row.order_header_id"    id="custom_table_oder_header_id" /> 
                            <span style=" color: #E13300"  v-bind:id="[[index+1+'msg']]" ></span>
                        </td>                    
                        <td>
                                <button  v-if="row['doc_number']!=''"     v-bind:id="row.line_id" style="    line-height: 12px;"      class="btn btn-sm btn-primary" onclick="line_activity(this)">Add Line Activities</button>                            
                               
                               <span   v-if="row['doc_number']!=''">

                                <button   v-if="row['line_status']=='Draft'"     v-bind:id="row.header_id"  style="    line-height: 12px;"     onclick="request_pdi(this)"   class="btn  btn-sm btn-primary">Submit Request </button>
                       

                               </span>
                              
                       
                            </td>                        
    
                      </tr>
                    </tbody>
                  </table>
            </div>
    
            </div>
            
            
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
              <button type="button" class="btn bg-olive btn-flat"  id="sbtn_pdi" onclick="create_pdi_req_header()" >Save</button>
    
    
            </div>
            
          </div>
        
        
        
        </div>
      
    
    
    
    
    </div> -->

    <div class="modal  fade modal-small in" id="pdi_req_line_modal" role="dialog">
        <div class="modal-dialog modal-lg" style="    max-width: 50% !important;">
          <div class="modal-content">      
            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title" style="font-weight: 800;"></h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body"  id="pdi_req_line_modal_body" style=" padding-left: 3%;      padding-right: 3%; margin-bottom: 4%; margin-top: 1%;">                  
            </div>
            
            <!-- Modal footer -->
           
          </div>
        
        
        </div>
      
    
    
    
    
    </div>



<div class="modal  fade modal-small in" id="ret_modal" role="dialog">
    <div class="modal-dialog modal-lg" style="    max-width: 65% !important;">
      <div class="modal-content">      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" style="font-weight: 800;">Return Sales</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
            <div class="row">
            <div class="col-sm-2">
            <label>

                Return Type :

            </label>

            </div>
            <div class="col-sm-5 text-left">
                <select class="form-control" :required="true" id="sales_type_list" onchange="get_ret_line_type(this)">
                    <option  v-for="option in ret_type"    v-bind:value="option.id" >[[option.text ]]</option>
                  </select>

            </div>
            </div>

            <br>

          
            <div class="table-responsive-sm">
              
              <table id="firstTable" class="table table-sm  table-hover table-responsive" style="white-space: nowrap;">
                <thead>
                    <tr>
                    <!-- <th v-for="row in ret_line_col"> [[row.title]]</th> -->
                    <th class="text-center" >SR </th>
                    <th  class="text-center">Item Name</th>
                    <th  class="text-center">Qty</th>
                    <th  class="text-center" style="width: 4%;">Returned</th>
                    <th  class="text-center" style="width: 4%;">Return Qty</th>
                    <th  class="text-center">Return Category</th>        
                    <th  class="text-center">Return Reason</th>    
                    <th  class="text-center"  style="display: none;">Line Type</th>                                 
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(row,index)  in ret_line_data">
                    <td>[[row.line_number]]</td>
                    <td  style="text-align: center; padding-top: 12px;" >[[row.item_code]] <br>  <input type="hidden"  v-bind:value="row.order_header"    id="custom_table_oder_number" />
                        <input type="hidden"  v-bind:value="row.order_header_id"    id="custom_table_oder_header_id" /> 
                        <span style=" color: #E13300"     v-bind:id="[[index+1+'msg']]" ></span></td>
                    <td  style="text-align: center; padding-top: 12px;"  >[[row.ordered_qty]]</td>     
                    <td style="text-align: center; padding-top: 12px;">[[row.returned]]</td>    
                    <td ><input      type="text" class="form-control"  placeholder="0" v-bind:id="[[index+1]]"  v-bind:data_val="[[row.ordered_qty- row.returned]]"   name="qty[]"  value="0" onkeyup="receivedPurchase(this)"  /></td>  
                    <td>
                        <select class="form-control" :required="true" >
                            <option  v-for="option in ret_line_reason_lov"   v-bind:value="option.lookup_code" > [[option.meaning ]]</option>
                          </select>
                    </td>
                    <td><textarea style="    width: 100%;line-height: 31px;"  rows="1" placeholder="Return remarks " ></textarea><input type="hidden"  v-bind:value="row.inventory_item_id"  />                     
                        
                    </td>
                    <td  style="display: none;"> 

                            <select   v-bind:id="[[index+1+'ret_line_type']]"  >
                                <option  v-for="option in ret_line_type"    v-bind:value="option.value" > [[option.display ]]</option>
                            </select>

                    </td>

                  </tr>
                </tbody>
              </table>
            </div>

        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
          <button type="button" class="btn bg-olive btn-flat"  id="sbtn_r" onclick="savereturn()" >Save</button>


        </div>
        
      </div>
    
    
    
    </div>
  




</div>


  <!-- The Modal -->






<div class="modal  fade modal-small in" id="ret_rec" role="dialog">
    <div class="modal-dialog modal-lg" style="    max-width: 65% !important;">
      <div class="modal-content">      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" style="font-weight: 800;">Return Receiving</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="ret_rec_body">
        

        </div>  
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
          <button type="button" class="btn bg-olive btn-flat"  onclick="ret_receving_btn()" >Confirm Receiving</button>
        </div>        
      </div> 
    
    
    </div>
</div>



</div>
<div class="modal" tabindex="-1" role="dialog" id="approver_history">
    <div class="modal-dialog" role="document" style="    max-width: 100%;">
      <div class="modal-content">
        <div class="modal-header">        
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body"  id="time_lines_list">       

            <!-- <div class="row d-flex justify-content-center">
                <div class="col-md-12">
                    <div class="main-card mb-3 card">
                        <div class="card-body">              
                            <div class="vertical-timeline vertical-timeline--animate vertical-timeline--one-column" id="time_lines_list">
                              

                            </div>
                        </div>
                    </div>
                </div>
            </div> -->
         
         

        </div>        
        <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>








<div class="modal" tabindex="-1" role="dialog" id="initiate_payment_modal"  data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="    max-width: 100%;margin-left: 1%;">
      <div class="modal-content">
        <div class="modal-header">

          <h4 class="modal-title">Initiate Advance Payment</h4>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">

         <div class="table-sm" id="initiate_payment_modal_data">
           
            

         </div>

         
         

        </div>
        
        <!-- <div class="modal-footer"    id="initiate_payment_modal_data_footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
         
        </div> -->
      </div>
    </div>
  </div>



  <div class="modal" tabindex="-1" role="dialog" id="reservation_detail"   tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="    max-width: 100%;margin-left: 1%;">
      <div class="modal-content">
        <div class="modal-header">

          <h4 class="modal-title">Reservation Details</h4>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">


            <div id="rdtl"></div>
         

        </div>
        

      </div>
    </div>
  </div>









  


  <div class="modal" tabindex="-1" role="dialog" id="reservation_modal">
    <div class="modal-dialog" role="document" style="    max-width: 65%;">
      <div class="modal-content">
        <div class="modal-header">

          <h4 class="modal-title">Extend Reservation <span id="res_number"></span></h4>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
        <div class="row">

            <div class="col-sm-2">
                <label> Remarks :</label> 
           </div>

           <div class="col-sm-6">
                        <textarea   style="    width: 100%;" placeholder="Please write here"   id="remarks"></textarea>
           </div>
        </div><br>
           <div class="row">

            <div class="col-sm-2">

                <label>Days :</label> 

            </div>
            <div class="col-sm-6">
                  <input  style="width:100%;"  type="text" id="days" value="7" />

            </div>
        </div>




         
         

        </div>
        
        <!-- <div class="modal-footer"    id="initiate_payment_modal_data_footer">
          <button type="button" class="btn btn-secondary" onclick="extend_reser()"  >Update</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
         
        </div> -->
      </div>
    </div>
  </div>







<style>
	.autocomplete {
  /*the container must be positioned relative:*/
  position: relative;
  display: inline-block;
}
	.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}
.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}
.autocomplete-items div:hover {
  /*when hovering an item:*/
  background-color: #e9e9e9;
}
.autocomplete-active {
  /*when navigating through the items using the arrow keys:*/
  background-color: DodgerBlue !important;
  color: #ffffff;
}

.initSelc2  + .select2-container--default .select2-selection--single .select2-selection__rendered {
    color: #444;
    line-height: 36px;
}

.initSelc2  + .select2-container .select2-selection--single 
{
    box-sizing: border-box;
    cursor: pointer;
    display: block;
    height: 50px;
    user-select: none;
    -webkit-user-select: none;
}

.select2-container .select2-selection--single {
   
    height: 100% ; 
    padding: 6px;
    
}
</style>

<!-- //////////////////////sher/////////////////// -->
<!-- <div class="row" id="counts_row" hidden style="margin: unset !important;"> 
    <div class="col-12 col-sm-6 col-md-3">
      <div class="info-box" onclick="onDashClick(this)" style="background-color:#a0a0a0">
        <span class="info-box-icon bg-info elevation-1"><i class="ion ion-cube"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Create Sales Order</span>
          <span class="info-box-number">
            
            <small></small>
          </span>
        </div>
      </div>
    </div>
    
    <div class="col-12 col-sm-6 col-md-3">
      <div class="info-box mb-3" onclick="onDashClick(this)">
        <span class="info-box-icon bg-danger elevation-1"><i class="ion ion-refresh"></i></span>

        <div class="info-box-content">

          <span class="info-box-text">In Process Orders</span>
          <span class="info-box-number">[[data.reserved_stock]]</span>
        </div>
        
      </div>
    </div>
    


    <div class="clearfix hidden-md-up"></div>

    <div class="col-12 col-sm-6 col-md-2">
      <div class="info-box mb-3" onclick="onDashClick(this)">
        <span class="info-box-icon bg-success elevation-1"><i class="ion ion-android-archive"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Approved Orders</span>
          <span class="info-box-number">[[data.on_order]]</span>
        </div>
        
      </div>
    </div>



    <div class="col-12 col-sm-6 col-md-2" >
        <div class="info-box mb-3" onclick="onDashClick(this)">
          <span class="info-box-icon bg-warning elevation-1"><i class="ion ion-filing"></i></span>
  
          <div class="info-box-content">
            <span class="info-box-text">Closed Orders</span>
            <span class="info-box-number">[[data.closed_orders]]</span>
          </div>
          
        </div>

      </div>


    
    <div class="col-12 col-sm-6 col-md-2">
      <div class="info-box mb-3" onclick="onDashClick(this)">
        <span class="info-box-icon bg-warning elevation-1"><i class="ion ion-filing"></i></span>

        <div class="info-box-content">
          <span class="info-box-text">Return Orders</span>
          <span class="info-box-number">[[data.all_on_order]]</span>
        </div>
        
      </div>

    </div>

    <div class="col-12 col-sm-6 col-md-2" style="display: none;">
        <div class="info-box mb-3" onclick="onDashClick(this)">
          <span class="info-box-icon bg-warning elevation-1"><i class="ion ion-filing"></i></span>
  
          <div class="info-box-content">
            <span class="info-box-text">PDI Requests</span>
            <span class="info-box-number">[[data.pdi_req]]</span>
          </div>
          
        </div>

      </div>


    
  </div> -->


<div class="row" style="margin: unset;">
          <div class="col-lg-12 col-lg-6">
            <div class="card card-primary card-outline card-outline-tabs">
              <div class="card-header p-0 border-bottom-0">
                <ul class="nav nav-tabs" id="custom-tabs-four-tab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="custom-tabs-four-home-tab" data-toggle="pill" href="#custom-tabs-four-home" role="tab" aria-controls="custom-tabs-four-home" aria-selected="true">Create Order</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-four-profile-tab" data-toggle="pill" href="#custom-tabs-four-profile" role="tab" aria-controls="custom-tabs-four-profile" aria-selected="false">Preview</a>
                  </li>
                </ul>
              </div>
              <div class="card-body p-0">
                <div class="tab-content" id="custom-tabs-four-tabContent">
                  <div class="tab-pane fade show active" id="custom-tabs-four-home" role="tabpanel" aria-labelledby="custom-tabs-four-home-tab">
                     <div class=" common_area_cls" id="avlable_stock" >

<input type="hidden"  id="cust_disc_perc" value=0 />
<input type="hidden"   id="discount_id" value=0 />


<input type="hidden"  id="actual_bal_amount" value=0 />
<input type="hidden"  id="customer_limit" value=0 />
<div class="accordion" id="accordionExample">
    <div class="card m-0">
        <div class="card-header" id="headingTwo_1" style="padding: 0px">
            <h2 class="mb-0">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-xl-3">
                       <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="">Fill Customer Details</button>  
                    </div>
                    <div class="col-lg-6 col-md-6 col-xl-6">
                        <div class="card-body" style="padding: 0px" hidden>
                            <div class="form-group row col-lg-12" >
                                <label  class="col-sm-3 text-right col-form-label" style="font-size: 16px;">Search By :</label>
                                
                                <div class="col-sm-4" style="margin-top: 7px;">
                                    <select name="" class="form-control-plaintext"  id="serach_based_on_type" style="width: 100% ; ">       
                                        <option value=""></option>                   
                                    </select>
                                <!-- <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="email@example.com"> -->
                                </div>
                            </div>
                        </div>  
                    </div>
                    <div class="col-lg-3 col-md-3 col-xl-3">
                    <span id="sel_cust" style="float: right;font-size: 16px;color: green;padding-top: 12px;"></span>  
                    </div>
                </div>
            </h2>
        </div>
        <!-- multi-collapse -->
        <div id="" class="" aria-labelledby="headingTwo_1" > 
            <div class="card-body" style="padding: 0px">
                <div class="row"  id="cart_area">
                    <div class="col-sm-6 col-md-6  col-xl-6  p-0">
                        <div class="card m-0">
                            <div class="card-header">
                                <h3 class="card-title">Bill To Customer</h3>
                                <div class="card-tools"style="margin-top: -10px;">      
                                    <a target_='blank' id="new_customer_url" href='#' target='_blank' style="float: right; margin: 0px;">New Customer : <i class="fa fa-plus-square" aria-hidden="true" style="float: right;margin-top: 2px; margin-left: 6px;font-size: 19px;"></i></a> 
                                </div>
                            </div>  
                            <div class="card-body" style="padding-top: 5px; padding-bottom: 0px;">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <select name="" id="searchCust"  class="form-control-sm" style="width: 100% ; ">
                                                <option></option>
                                            </select>
                                            <input type="hidden" id="main_cust" />
                                            <input type="hidden" id="main_customer_number" />
                                            <input type="hidden" id="main_customer_id" />
                                        </div>
                                        <div id="customer_infoo" class="row">
                                        </div>                                 
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-none">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-6  col-xl-6 p-0">
                        <div class="card m-0">
                            <div class="card-header">
                              <h3 class="card-title">                      
                                Ship To Customer                      
                              </h3>
                              <div class="card-tools">
                              </div>
                            </div>  
                            <div class="card-body" style="padding-top: 5px; padding-bottom: 0px;">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">                                              
                                            <select name="" class="col-sm-4 form-control-sm" data-special-id="customer-search"  id="customer" style="width: 100%;"></select>
                                        </div>
                                        <div id="ship_to_customer_infoo" class="row"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-none">
                            </div>
                        </div>
                    </div>


<!--  //////////////////////////////////Sher////////////////////////////////  -->
                           <div class="col-sm-6 col-md-6  col-xl-6 " hidden>



                            <div class="card">
      
                                <div class="card-header">
                                  <h3 class="card-title">                      
                                    Bill To Customer                      
                                  </h3>
                                  <div class="card-tools">      
                                  
                                    <!-- <span class="badge badge-primary">
                                     
                                    <!-- <a target_='blank' id="new_customer_url" href='#' target='_blank' style="float: right;">New Customer : <i class="fa fa-plus-square" aria-hidden="true" style="float: right;margin-top: 2px; margin-left: 6px;font-size: 19px;"></i></a> 
                                     -->
                                    <!-- </span> -->
                                    
                                  </div>
                                </div>  
                              
                                <div class="card-body">
            
                                    <div class="row">
                                        <div class="col-sm-12">


                                            <div class="form-group">                                              
                                                <select name=""   id="customer_bill" class="form-control-sm"  style="width: 100% ; "></select>
                                            
                                            </div>
                                            

                                            <div id="bill_to_customer_infoo">

                                                
                                            </div>

                                
                                     
                
<!--                                        
                              
                                       <form>
                                           <fieldset>
                                               <h3 style="max-width: 30%;">Bill To:</h3>
                
                
                                               <table style="width:100%" id="ship_to_tbl">
                                                   <tr  style="display: none;">
                                                       <th>
                                                           Location</th>
                
                                                  <td>
                                                       
                                                       <input type="text" class="form-control  form-control-sm " id="location_bill"  placeholder="" readonly>
                                               
                                                   </td>
                                                   </tr>
                
                                                   <tr><th>Customer</th>
                                                       <td>
                                                      
                                                       <select name="" class="form-control  form-control-sm "  id="customer_bill" style="width: 100% ; "></select>
                                                   </td>    
                                                   </tr>
                
                                               
                                               <tr>
                                                   <th>Number</th>
                                               
                                                   <td>
                                                         <select disabled  class="form-control  form-control-sm " id="number_bill"  style="width: 100% ; "></select>
                                                   </td>
                                               
                                               </tr>
                
                                                   <tr>
                                                       <th>Address</th>
                                                       <td>
                                                           <input type="text" class="form-control  form-control-sm " id="address_bill"  placeholder="" readonly>
                                                       </td>
                                                   </tr>
                
                                               <div class="m-1 row " style="display:none;">
                                                       <label for="address_2"
                                                           class="col-sm-3 col-form-label"></label>
                                                       <div class="col-sm-8">
                                                           <input type="text" class="form-control  form-control-sm " id="address_2_bill"  placeholder="" readonly>
                                                       </div>
                                               </div>
                
                                               <div class="m-1 row" style="display:none;">
                                                       <label for="address_3"
                                                           class="col-sm-3 col-form-label"></label>
                                                       <div class="col-sm-8">
                                                           <input type="text" class="form-control  form-control-sm " id="address_3_bill"  placeholder="" readonly>
                                                       </div>
                                               </div>
                                               <tr><th> </th><td>
                                                           <input type="text" class="form-control  form-control-sm " id="area_bill"  placeholder="" readonly>
                                               </td></tr>
                
                                               <tr><th> </th><td>
                                                           <input type="text" class="form-control  form-control-sm " id="country_bill"  placeholder="" readonly>
                                               </td></tr>
                
                                               <tr>
                                                   <th> Contact 
                
                                                   </th>                                            
                                                   <td> 
                                                        <input type="text" class="form-control  form-control-sm " id="contact_bill"  placeholder="" readonly>
                                                  
                                                   </td>
                                                 
                                               </tr>
                                               </table>
                
                
                
                                           </fieldset>
                                       </form>
                 -->
                
                                       
                                   </div>
                               </div>
                           </div>

                           <div class="card-footer d-none">
                      
                        </div>
                         
                      
                        </div>
                       
                    
                    </div>
                
                
                
                
              </div>          
                
                       <!-- </div>
                       
                   </div>
                </div> -->
                
    
                
            </div>
        </div>
    </div>

<div class="card" id="sp">
    <div class="card-header p-1" id="headingOne">
         <h2 class="mb-0">
             <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#">Search Stock</button>
         </h2>
     </div>
     <div id="" class="" aria-labelledby="headingOne">
        <div class="card-body">
            <!-- <div class="col-lg-12 col-md-12 col-xs-6 col-sm-6">

                <input type="text" id="item_code" placeholder="Item Code">
                <input type="text" id="quantity" placeholder="Quantity">
                <input type="button" class="btn btn-success add-row" value="Add Row">
            </div> -->
            <div class="table-responsive" style="" >
                <div class="row">
                    <div class="col-sm-4">
                      <b>Total Count :</b> <span id="total_records">0</span>  
                    </div>
                    <div class="col-sm-8 right">
                        <textarea name ="excel_data" cols="500" id="excel_data" hidden></textarea> 
                        <textarea name ="excel_data" id="new_excel_data" hidden></textarea> 
                        <input type="text" name="" id="customer_vat" hidden> 
                        <input type="tet" name="" id="customer_id" hidden>
                        <input type="text" name="" id="page_info" value="saleswores" hidden>
                        <button type="button" class="btn btn-info" onclick="getItemStock()">Get Stock</button>
                        <button type="button" class="btn btn-danger" onclick="removeNotFoundItem()">Remove Not Found Item</button>
                        <button type="button" class="btn btn-info" onclick="inventorytransfer()" hidden>Inventory Transfer</button>  
                    </div>
                </div>
                <table class="table table-sm table-bordered text-sm mt-2 mb-0"   style="white-space:nowrap;"  id="sp_products">
                    <thead>
                        <tr>
                            <td colspan="11" style="border-top: unset; border:none; "></td>
                            <td style="border: 1px solid #17a2b861;font-size: 18px;" id="grand_val2"></td>
                            <td style="border: 1px solid #17a2b861;font-size: 18px;" id="grand_line_total2"></td>
                        </tr>
                    </thead>
                    <thead>
                      <tr>
                        <th></th>
                        <th>No #</th>
                        <th>Barcode</th>
                        <th>Item Code</th>
                        <th>Item Desc</th>
                        <th>UOM</th>
                        <th>Avl Qty</th>
                        <th>Qty</th>
                        <th>Unit Price</th>
                        <th>Gross Amount</th>
                        <th>Discount</th>
                        <th>VAT</th>
                        <th>Line Total</th>
                      </tr>
                    </thead>
                    <tbody id="sp_product_id">
                        {% if item_list_data %}
                        
                            {% for  value in item_list_data %}
                            <tr id="{{value.item_code}}">
                                <td>
                                    <button class="delete-item btn btn-sm btn-danger" style="margin-right: 10px;" stylehide_btn_remove  data-name="{{value.item_code}}"><i class="right fas fa-times"></i></button>
                                    <button   style='display:none;background-color:transparent; font-size: 11px;color: white;padding: 7px 7px;' class="{{value.item_code}}" id='blink-bg'></button>
                                </td>
                                <td>{{forloop.counter}}</td>
                                <td>{{value.barcode}}</td>
                                <td>{{value.item_code}}</td>
                                <td>{{value.description}}</td>
                                <td>{{value.primary_uom_code}}</td>
                                <td id="res_quantity{{value.item_code}}"></td> 
                                <td>
                                    <input type="number" oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');" style="width:50%" id="quantity{{value.item_code}}" item_code="{{value.item_code}}" onblur="updateQuantity(this)" value="{{value.ordered_qty}}">
                                </td>
                                <td>{{value.list_price}}</td>
                                <td>
                                    <input type="number" style="width:50%" id="price{{value.item_code}}" readonly disabled item_code="{{value.item_code}}" onblur="updatePrice(this)" value="{{value.unit_selling_price}}">
                                </td>
                                <td><input type="text" name="line_discount" style="width:100%"></td>
                                <td id="vat{{value.item_code}}"></td>
                                <td id="total_price{{value.item_code}}">{{value.line_total}}</td>

                            </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                    <tbody id="search_product_tbody">
                    <tr id="search_product_tr">
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"><input type="text" name="" style="width:100%; height:30px" id="sp_products_item_code" placeholder="Enter the Item Code" autocomplete="off"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                        <td style="padding: 0; margin: 0;"></td>
                    </tr>                        
                    </tbody>
                    
                </table>
                <div class="row">
                    <div class="col-sm-6">
                        <div id="showitemid" style="overflow: auto; max-height: 315px; width: 50%;margin-left: 29%;">
                            
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-8">
                        <h6 hidden>Term & Conditions</h6>
                        <textarea hidden id="terms_conditions"  name="terms_conditions" rows="4" cols="50"></textarea>
                    </div>
                    <div class="col-md-4">
                        <table class="table">
                           <tbody>
                            <tr>
                                 <th style="width:50%">Discount /Surcharge:</th>
                                 <td class="disc_srsum right" id="total_disc_srsum"></td>
                              </tr>
                              <tr>
                                 <th style="width:50%">Total Line Total:</th>
                                 <td class="right" id="grand_line_total"></td>
                                 <td class="d-none" id="grand_line_total_only_items">0</td>
                              </tr>
                              <tr>
                                 <th style="width:50%">Vat:</th>
                                 <td class="right" id="grand_val"></td>
                              </tr>
                              <tr>
                                 <th>Total:</th>
                                 <td class="right" id="grand_total"></td>
                              </tr>
                           </tbody>
                           <input type="tet" name="" id="customer_id_id" value="{{id}}" hidden>
                           <input type="tet" name="" id="customer_text" value="{{text}}" hidden>
                           <input type="tet" name="" id="customer_customer_number" value="{{c_number}}" hidden>  
                           <input type="tet" name="" id="customer_customer_name" value="{{c_name}}" hidden>
                           <textarea id="quotation_item" hidden>{{item_code_data}}</textarea>
                       </table>
                    </div>
                </div>
        </div>
                <table class="table tbl_font table-hover table-sm dataTable"   style="white-space:nowrap;"  id="products"></table>
                
            </div>
        </div>
    </div>
</div>
</div>
                  </div>
                  <div class="tab-pane fade" id="custom-tabs-four-profile" role="tabpanel" aria-labelledby="custom-tabs-four-profile-tab">
                     <div class="card-body">
      


            <div class="row"  id="cart_area">
            
                <div class="col-sm-12" id="stock_view" style="text-align: left;">
                       <div class="card">
                           <div class="card-header bg-info" style="display: none;">
                               <h5 class="m-b-0 text-white">Cart
                                   <i style="color: white;    float: right;" id="full_screen"   onclick="fullscreen(this.id)"  class="fa fa-plus fa-1x "  aria-hidden="true"></i>
                               </h5>
                              
                           </div>
                           <div >
                               
                       <!--<a  class="btn btn-default btn-sm  waves-effect waves-light" data-toggle="collapse" href="#collapseExample" id="cart_number" role="button" aria-expanded="false" aria-controls="collapseExample">
                               <i class="mdi mdi-cart"></i>    Cart
                       -->
            
                       <a type="button" style="display: none;"   id="btn_cart" data-toggle="collapse" href="#collapseExample" aria-controls="collapseExample" class="btn btn-sm waves-effect waves-light cart-btn btn-primary collapsed" aria-expanded="false"><i class="mdi mdi-cart"></i>Cart (<span class="total-count">0</span>)</a>
                              
                       <a type="button" style="display: none;"  id="btn_cart_1"  href="{% url 'checkout_page' %}"  class="btn btn-sm waves-effect waves-light cart-btn btn-primary " aria-expanded="false">
                               <i class=" mdi-open-in-new mdi mdi-cart"></i> checkout
                       </a>
                     
            
            
              <!-- <div class="collapse" id="collapseExample">
               <div class="card ">
                      <table class="table table-sm  no-wrap table table-sm table-bordered text-center show-cart" id="show-cart">
            
                       </table>
                                                  
            
               </div>
               <button id="clear-cart" class="btn btn-default btn-sm">Clear Cart</button>
               </div> -->
               
               <ul class="nav nav-tabs" id="myTab" role="tablist">
                   <li class="nav-item"    style="display: none;">
                     <a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="flase">Units Stock</a>
                   </li>
                   <li class="nav-item" style="    display: none;">
                     <a class="nav-link active" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="true" onclick="get_order_type_lov()">Shopping Cart</a>
                   </li>
                   <!-- <li class="nav-item">
                     <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Accessories Stock</a>
                   </li> -->
                 </ul>
            
                 <div class="tab-content" id="myTabContent">
                   <div class="tab-pane fade show active" id="home" role="tabpanel" style="display: none;" aria-labelledby="home-tab">
            
                           <div class="row">
                               <!-- column -->
                               <div class=" col-md-12">
                                   <div class="card">
                                       
                                       
                                       <div class="table-responsive" style="margin-top: 11px;">
            <!-- 
                                           <button  type="button" class="add-to-cart pull-right btn btn-sm btn-info" onclick="" >Add To Cart <i style="color: white;" class="fa fa-cart-plus fa-1x "  aria-hidden="true"></i></button> 
            
                                           <table  class="table w-100 table-sm table-responsive table-bordered table-striped no-wrap"     id="products"></table>
            -->
                                       </div>
                                   </div>
                               </div>
                               
                           </div>
            
            
            
            
                   </div>
            
            
                   <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                           <!--tydeaitls here-->
            
                           
                           <div class="card">  
                              
                            <!-- <div class="card-body" id="invoice_total_v">   -->
                                <div id="invoice_total_v" style="    padding: 14px;">  
                                    <div id="data"></div>
                                <form action='#'> 
                                    {% csrf_token %} 
                                    <div class="form-row">  
                                        

                                        <div class="col-md-3">  
                                            <label>Order Type: <span style="color: red;"> *</span></label>  
                                            <select style="width: 100%;"  class="select2-input form-control-sm form-control"    id="order_type_lov_item_page" onchange="order_header_change(this)">                            
                                             </select>  
                                        </div> 

                                        <div class="col-md-3">  
                                            <label>Order Category: <span style="color: red;"> *</span></label>                                                  
                                            <select class="form-control form-control-sm" required="true" id="order_category_lov">
                                                <option  v-for="option in order_category"    v-bind:value="option.value" >[[option.flex_value ]]</option>
                                              </select>
                                         </div>





                                        <div class="col-md-3">  
                                            <label>Ship To Customer:</label>  

                                            <input type="text"  readonly  id="shiptocust"  class="form-control form-control-sm" />  
                                    

                                        </div> 

                                        <div class="col-md-3">  
                                            <label>Bill To Customer: </label>  

                                            <input type="text"  readonly  id="billtocust"  class="form-control form-control-sm" />  
                                    
                                        </div> 

                                        
                                        

                                        <div class="col-md-3">  
                                            <label>Customer LPO:</label>  
                                            <input type="text" id="customer_po"  class="form-control form-control-sm" />  
                                        </div> 



                                        <div class="col-md-3">  
                                            <label>Air Miles :</label>  
                                            <input  type="text" class="form-control form-control-sm" id="txt_air_miles"></textarea>
                                         </div>



                                          


                                        <div class="col-md-3">  
                                            <label>Tax (<span id="vat_percent">[[vat_p]]</span>%) :</label>  
                                            <input  readonly   id="tax" :value="Number(tv).toFixed(2)"   type="text" class="form-control form-control-sm" />  
                                        </div>

                                        <div class="col-md-3">  
                                            <label>Sub Total :</label>  
                                            <input type="text"  readonly  id="subtotal" :value="Number(t).toFixed(2)" class="form-control form-control-sm" />  
                                        </div>


                                        
                                    </div>  
                                    <div class="form-row">  

                                        <div class="col-md-6">  
                                            <label>Leads :</label>  
                                            
                                            <select class="form-control form-control-sm" required="true" id="leads_lov">
                                                <option  v-for="option in leads"    v-bind:value="option.value" >[[option.flex_value ]]</option>
                                              </select>

                                         </div>

                                         <div class="col-md-3">  
                                            <label>Discount / Surcharge :</label>  
                                            <input readonly type="text" id=""  :value="Number(td).toFixed(2)"  placeholder="Enter Mobile Number" class="form-control form-control-sm" />  
                                        </div> 

                                        <div class="col-md-3">  
                                            <label>Grand Total :</label>  
                                            <input readonly  type="text"  :value="Number(gt).toFixed(2)" id="g_total"  placeholder="" class="form-control form-control-sm" />  
                                        </div> 

                                          
                                    </div>   
                                       <div class="form-row">  
                                           <div class="col-md-6">                                            
                                            
                                           

                                             <div class="col-md-12">  
                                                <label>Order Note :</label>  
                                                <textarea   type="text" class="form-control form-control-sm" id="order_remarks"></textarea>
                                             </div>

                                            </div>  
            
                                           <div class="col-md-6"> 
                                            <br>
                                            
                                            <div id="error_area" style="height: 126px;">


                                            </div>
                                           
                                           <div class="col-md-12" style="display: none;">  
                                            <label> Line Charges :</label>              
                                            <input readonly  type="text"  id='line_charges'   :value="Number(total_line_charges).toFixed(2)"    abc     placeholder="00.0" class="form-control form-control-sm" />  

                                      


                                        </div> 

                                           
                                        <!-- <div class="col-md-12" style="    margin-top: 16px;">  
                                            <label style="display:inline-flex;width: 100%;">Print Charges :   <input   type="checkbox"  id="print_charges"  style="width: 30%;  zoom: .8;"  class="form-control" />  </label>  
                                              
                                        </div>  -->
                                        </div>
            
                                       </div>  
                                       <div class="form-row">  
                                           <div class="col-md-6">  
                                                
                                           </div>  
                                            
                                       </div> 
                                      
                                   </form>  
                               </div>  
                                                

                            
                          
                          
                            </div> 
            
                
            
            
            
                           <div class="card">
                            <!-- <div class="row">
                               
                                <div class="col-6">
                                
                                                      
            
                                     
            
                                </div>    
                        
                                <div class="col-0 text-right">-->
                                   <!-- <button id="clear-cart" class="btn btn-default btn-xs">Clear Cart</button>  
                                   
                                   <br>
                                 </div>
                             
            
            
                            </div> -->
            
                            <!-- <div class="row pt-3">
            
            
                               <div class="col-12 text-right">
                                      -->
                                   <!-- <button id="daft_lines" class="btn waves-effect waves-light btn-info btn-sm" >Save Item</button> 
                                    <button id="clear-cart" class="btn btn-default btn-sm">  Clear Cart &nbsp;&nbsp; <i class="fa fa-times" aria-hidden="true"></i> </button> 
                                    <button type="submit" id="btn_order" onclick="submit_order(this)" class="btn btn-default btn-sm">  Create sales order &nbsp;&nbsp; <i class="fa fa-usd" aria-hidden="true"></i> </button>
                                    
                                    </div>
            
            
                            </div> -->
            

                        
                                 <div id="show-cart-parent_div" style="overflow: unset;padding: 10px;"> 

                                <table class="table tbl_font  table-sm  show-cart"  id="show-cart" >
                        
                                </table>  

                                </div>
                              
                                 
                        
                            </div>
                            <div class="row">
                    <div class="col-8">
                        <h6 hidden>Term & Conditions</h6>
                        <textarea hidden id="terms_conditions"  name="terms_conditions" rows="4" cols="50"></textarea>
                        <input type="text" name="" id="order_header" hidden>
                        <input type="text" name="" id="order_status" hidden>
                        <input type="text" name="" id="p_rec_level_id" hidden>
                        <input type="text" name="" id="order_type_input" value="Cash" hidden>
                    </div>
                    <div class="col-md-4">
                        <table class="table" style="margin-bottom:0px">
                           <tbody>
                            <tr>
                                 <th style="width:50%">Discount /Surcharge:</th>
                                 <td class="disc_srsum right"></td>
                              </tr>
                              <tr>
                                 <th style="width:50%">Vat:</th>
                                 <td class="vatsum right"></td>
                              </tr>
                              <tr>
                                 <th>Total:</th>
                                 <td class="line_tsum right"></td>
                              </tr>
                           </tbody>
                       </table>
                    </div>
                </div>
                        
                            <div id="customer_receipt">


                            </div>
                            

<br>


                            <div style="margin-top:15px;    text-align: right;">  
                                <input type="hidden" id="temp_order_number_to_oracle_order" value="" />
                                <div id="msg_for_edit_order"  style='text-align: left;margin-bottom: 11px;'></div>

                                   
                                   <button type="button"  id="clear-cart"  class="btn btn-sm btn-danger rounded-0">Clear Cart</button>  
                                   <!-- <button type="button"  id="create_los"  onclick="los_modal_s(this)"  class="btn btn-sm btn-danger rounded-0">Create LOS</button>  -->
                                   <!-- <button type="button"  id="validate_order" onclick="validate_order(this)"  class="btn btn-primary rounded-0">validate order</button>   -->
                                  
                                   <button type="button"  id="btn_draft_it" onclick="submit_order(this)"  class=" btn-sm btn btn-primary rounded-0">Save as Draft</button>  
                                   <button type="button"  id="btn_req_credit" onclick="submit_order(this)"  class="btn btn-sm  btn-primary rounded-0">Req credit limit</button>  
                                   <button type="button"  id="btn_order" onclick="submit_order(this)"  class="btn btn-primary btn-sm rounded-0">Create Sales Order</button> 
                                   
                                   
                                  
                                   

                               </div>  
                          
                               <br><br>
                               <br><br>
            
            
                   </div>
            
                   <!-- <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">Accessories Stock</div> -->
            
                 </div>
            
                           </div>
                       </div>
            
               </div>
              
     
        
        
        
        
        
        
        
            </div>
            

            
        </div>
                  </div>
                </div>
              </div>
              <!-- /.card -->
            </div>
          </div>
        </div>

<script>
    // function getItemDetail() {
    //     var data = $('#excel_data').val();
    //     rows = data.split("\n");
    //     items_code = []
    //     $.each(rows, function(index, value) { 
    //         row_data = value.split("\t")
    //         if(row_data[0] != 'Item Code'){
    //             item=row_data[0]+'/'+row_data[1]
    //             items_code.push(item)
    //         }
    //     });
    //     axios.get("/saleswores/search_items?&items="+items_code)
    //     .then(function(res)
    //     {
    //         var tbl='#sp_products'
    //         datatable_reload2(res,tbl);
    //     })
    //     .catch(function()
    //     {
           

    //     })
    // }
function getItemStock(){
    if((shoppingCart.listCart()).length > 0){
        shoppingCart.clearCart()
    }

    items_code = []
    var pastedData = $('#excel_data').val();
    var data = pastedData.split("\t")
    $.each(data, function(index, value) {
        if(value.search("1\n") == 0){
                testing = value.split("1\n")
                value= testing[1]
        }
        items_code.push(value)
    });
    console.log(items_code.length)
    update_datatable2(items_code)
}



</script>


<div class="card" id="asc" hidden>
           
    <div class="card-header" id="headingOne">
         <h2 class="mb-0">
             <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOne">2. Search Stock</button>									

             <button type="button" class="btn btn-info" onclick="scanBarcode()" >Scan Barcode</button>

             <button type="button" class="btn btn-info" onclick="clearBarcode()">Clear Barcode</button>	

             <script>
                 function clearBarcode() {
                    $('[type="search"]').val("");
                 }
                 var orgdisplayDivInfo;
                 function scanBarcode(){


                    var displayDivInfo = [].slice.call($('.container-fluid div')).map(x=>[x,x.style.display]);
                    orgdisplayDivInfo = displayDivInfo;
                    displayDivInfo.forEach(x=>{
                        if (x[0].id != 'cancelScan')
                            x[0].style.display = 'none';
                    });
                    
                    
                    
                    $('#cancelScan').show()
                    $('#reader').show();
                    new Html5Qrcode.getCameras().then(devices => {
                            if (devices && devices.length) {
                                var html5QrcodeScanner = new Html5Qrcode('reader', false);
                                // html5QrcodeScanner.render(onScanSuccess);

                                html5QrcodeScanner.start(devices[1].id, {
                                    fps: 10,
                                    qrbox: 250,
                                    aspectRatio: 1.5
                                }, success => {
                                    console.log(success);
                                    html5QrcodeScanner.stop();
                                    displayDivInfo.forEach(x=>{
                                        x[0].style.display = x[1];
                                    })
                                    $('#reader').hide();
                                    $('#cancelScan').hide();
                                    if ($('button:contains("2. Search Stock")').hasClass("collapsed")){
                                        $('button:contains("2. Search Stock")').click();
                                    }
                                    
                                    // $('[type="search"]').val().trigger("input")

                                    $('[placeholder="Search Barcode"]').val(success.trim()).trigger('change')
                                    
                                });

                            }
                        })
                            
              

                    //
                 }

                 function cancelScan(){
                    orgdisplayDivInfo.forEach(x=>{
                        x[0].style.display = x[1];
                    })
                    $('#reader').hide();
                    $('#cancelScan').hide();
                    if ($('button:contains("2. Search Stock")').hasClass("collapsed")){
                        $('button:contains("2. Search Stock")').click();
                    }
                    

                 }
             </script>								
        
             <!-- <span id="selected_item" style="float: right;font-size: 16px;color: green;padding-top: 12px;"></span> -->
            </h2>
     </div>
<div id="collapseOne" class="collapse" aria-labelledby="headingOne">
<div class="card-body">

<!-- <p>HTML stands for HyperText Markup Language. HTML is the standard markup language for describing the structure of web pages. <a href="https://www.tutorialrepublic.com/html-tutorial/" target="_blank">Learn more.</a></p> -->



<div class="block-finder__title text-dark" style="    font-size: 20px;
font-weight: bold; display: none;">ITEM DETAILS</div>
<!-- <br> -->
<!-- <select class="initSelc2 " >
<option></option>
</select> -->

<button  type="button" class="add-to-cart pull-right btn btn-sm btn-info" style="display: none;" onclick="" >Add To Cart <i style="color: white;" class="fa fa-cart-plus fa-1x "  aria-hidden="true"></i></button> 
<!-- <br><br> -->
<style>

.dataframe >thead > tr {


    text-align: center !important;
}

.dataframe >thead > tr  > th {

    border: 1px solid !important;

}


table.dataTable thead>tr>th
{

/* font-size: 14px; */
}
table.table-bordered.dataTable tbody td
{

/* font-size: 14px; */
}
</style>

<div class="table-responsive" style="display: none;">

<table class="table table-bordered table-hover w-100 table-hover tbl_font table-sm "   style="    white-space: nowrap;"  id="pre_filter"></table>

</div>


<!-- <div id="vProductTbl"> -->
<!-- <div class="products-view__list products-list products-list--grid--4" data-layout="table"
 data-with-features="false"> -->
 
 <div class="table-responsive " >
     
     <table id="search-tbl" class="tbl_font table table-sm" style="white-space: nowrap; width: 100%;">
         
     </table>

 <!-- </div> -->

<!-- </div> -->
</div>



<style>

#cash_collection{  width: 100% !important;   }


#products_wrapper > div:nth-child(2) > div
{
    overflow: scroll !important;
}
#sp_products_wrapper > div:nth-child(2) > div
{
    overflow: scroll !important;
}

#show-cart-parent_div{
    overflow: scroll;
}





.lbl_qty_count{


text-align: right;
color: #007bff;
}


</style>



<h3> Available Stock </h3>
<div class="table-responsive" style="    border: 1px solid;" >
<p id="sum"></p>
<!-- <table class="table tbl_font table-hover table-sm dataTable"   style="white-space:nowrap;"  id="products"></table> -->
</div>





</div>
</div>
 </div>


 <div class="card" hidden>
    <div class="card-header" id="headingTwo">
        <h2 class="mb-0">
            <button type="button" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" onclick="Preview_Order()"> 3. Preview Order </button>
        




             <a type="button" id="inv_href" target="_blank"  href="#" class="btn btn-sm waves-effect waves-light cart-btn btn-primary d-none" aria-expanded="true"   style="    float: right;
             margin-top: 7px;  margin-left: 39px;">               

                
                
              View Transfers List (<span class="inv_transfer_qty_selected">0</span>)
            </a>

         

            <span class="fa-stack fa-1x has-badge collapsed back-to-top" data-count="0"   data-toggle="collapse" data-target="#collapseTwo"   id="qty_selected" onclick="Preview_Order()" >
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-shopping-cart fa-stack-1x fa-inverse float"></i>
             </span>
<style>


#qty_selected
{
    cursor: pointer;
    zoom: 0.7;
    float: right;

}
    .fa-stack[data-count]:after {
    position: absolute;
    right: 0%;
    top: 0%;
    content: attr(data-count);
    font-size: 40%;
    padding: 0.6em;
    border-radius: 999px;
    line-height: 0.75em;
    color: white;
    color: green;
    text-align: center;
    min-width: 2em;
    font-weight: bold;
    background: white;
    border-style: solid;
    }

    .fa-circle 
    {
    color: green;
    }

    .red-cart {
    color: green;
    background: white;
    }

</style>



        </h2>
    </div>
    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo">
        
    </div>

</div>




<!-- <div id="reserved_stock" class="common_area_cls table-responsive" >

   
    <table   class="table table-bordered table-hover table-hover tbl_font table-sm"  style="    white-space: nowrap;"     id="tbl_reserved_stock"></table>

</div> -->





<style>
    .pull-left{float:left!important;
        width: 75%;
        margin-bottom: 40px;
    }
    .pull-right{float:right!important;}
    #search-tbl_filter{
    
        width: 90%;
    }
    #search-tbl{
        border: 1px solid;
    
    }
    #search-tbl_filter label
    {
            width: 100%;
    }
    #search-tbl_filter label input
    {
            width: 97%;
            height: 47px;
            font-size: 20px;
    }
    #search-tbl_length > label > select
    {
        height: 47px;
        font-size: 20px;
            
    }


    
#search-tbl > tbody > tr:hover{
    background-color: rgba(41, 103, 182, 0.89);
    color: #FFF !important;
    cursor: pointer;
}
#search-tbl > tbody > tr.selected 
{
    background-color: rgba(41, 103, 182, 0.89);
    color: #FFF;
}

#serach_based_on_type+span span span{

    font-size: 12px;
    padding: 0px;
    padding-left: 6px;
}
    </style>
{% endblock %}


{% block script_block %}


<script>

var counts_row=new Vue({
      el: '#counts_row',    
      delimiters:['[[',']]'], 
      data:
      {
        data: {{counts|safe}} 
      },
      methods: 
      {
      },  
  });
 





  var table_1;
  localStorage.setItem('defs','{{defs|safe}}')

  

  $(function()
  {


    //var abccccc=1
      try
      {
        var a=JSON.parse(localStorage.getItem('defs'))

        // $('#dep_amt').val(a.reservation_amount)
     }
     catch(error)
     {


     }

        //reservation_amount
        //axios.get("/sales/sd"+window.location.search+'&organization_code='+a['organization_code'])
		// axios.get("/sales/sd"+window.location.search)
        // .then(function(res)
        // {
		// 	// vProductTbl.columns = res.data.columns;
		// 	//initDT(res.data)
		// 	$('#search-tbl').append(buildTheadTfoot(res.data.columns));
		// 	var columnsMeta =res.data.columns.map(x=>x.data);


		// 	table_1=$('#search-tbl').DataTable({
		// 		"processing": true,
        //         "serverSide": true,
        //         "language": 
        //         {
        //             processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading..n.</span> '
        //         },
        //         "deferLoading": 0,
        //         "dom": '<"pull-left"f><"pull-right"l>tip',
		// 		colReorder: true,
        //        // "pageLength": 10,
        //         "oLanguage":
        //         {
        //             "sSearch": "Item Search :"
        //         },
        //         "destroy": true,               
        //         columnDefs:[
        //             {
        //                 targets:res.data.hcols,
        //                 visible:false
        //             }
        //         ],
        //         preDrawCallback: function(settings,json) {
		// 					//Should I put it here?
        //                    // alert(1)
                           
        //                 //this.context[0].jqXHR.abort()
        //                      try 
        //                      {
        //                         $(this).dataTableSettings[0].jqXHR.abort()
        //                     } 
        //                     catch (error) 
        //                     {
        //                         console.log(error);
                        
        //                     }

                       
        //                // table_1.context[0].jqXHR.abort()
        //         },
		// 		"ajax":{
		// 			type:"POST",
        //             'beforeSend': function (request) {
        //                 showloader('Searching.... Please wait... <button class="btn btn-sm btn-light" onclick="hideloader()"> Cancel </button>')
        //             },
        //             xhr: function() {
        //             var xhr = $.ajaxSettings.xhr();
        //             xhr.upload.onprogress = function(e) 
        //             {
        //                // xhr.abort(); //abort all current request here
        //               // table_1.settings()[0].jqXHR.abort()
        //                //alert(23)
        //             };
        //             return xhr;
        //             },
		// 			url:"/sales/sd",
		// 			headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    
        //         data : 
        //         {
        //         	's':'{{s}}',
        //             columnsMeta:JSON.stringify(columnsMeta),
        //             'defs':localStorage.getItem('defs')
                  

        //         },
		// 		},
		// 		drawCallback:function(d)                
        //         {
        //             hideloader();

		// 			// alert($('#search-tbl_filter input').val());
        //         //    console.log(d)
		// 			var sT= getCurUrlGETObj().s;				
        //             if (sT != $('#search-tbl_filter input').val())
        //             {
		// 				var toFind= $('#search-tbl_filter input').val().toLowerCase();						
        //             } else
        //             {
		// 				$('#search-tbl_filter input').val("{{s}}");
		// 				var toFind= "{{s}}".toLowerCase();
		// 			}
		// 			$('#search-tbl td').each(function()
        //             {
						
		// 				if ($(this).text().toLowerCase().indexOf(toFind) > -1)
        //                 {

		// 					var s= $(this).text().toLowerCase();
		// 					var start = s.indexOf(toFind);
		// 					var end = start + toFind.length;
		// 					var html = $(this).text().slice(0,start)+'<span class="font-weight-bold">'+$(this).text().slice(start,end)+'</span>'+ $(this).text().slice(end);
							
		// 					$(this).html(html)

		// 				}
		// 			})

		// 		},                 
        //         initComplete: function () 
                
        //         {

        //             var i=0;
        //              this.api().columns().every( function () 
        //             {

        //                 i++;
        //                 var a=Math.floor(Math.random() * 11);
        //                 var column = this;		
        //                 if(i==5)
        //                 {
        //                     $(column.footer()).append("<br>")
        //                     $(column.footer()).html(' ')

        //                     var select = $('<select id='+i+a+'   style="width: 100%;    padding: 3px;">'+res.data.business+'</select>')
        //                     .appendTo($(column.footer()))
        //                     .on('change', function () 
        //                     {
        //                         // var val = $.fn.dataTable.util.escapeRegex(
        //                         // $(this).val());
        //                     })

        //                 }


        //                 var that = this;	
        //                 console.log(that)	;
        //                 $( 'select', this.footer()).on( 'keyup change clear', function () 
        //                 {       
        //                     console.log(that)                     
        //                     if ( that.search() !== this.value ) 
        //                     {
		// 						that.search(this.value).draw();
		// 					}
		// 				});

                                                       

		// 				var that = this;	
        //                 console.log(that)	;
        //                 $( 'input', this.footer()).on( 'keyup change clear', function () 
        //                 {       
        //                     console.log(that)                     
        //                     if ( that.search() !== this.value ) 
        //                     {
		// 						that.search(this.value).draw();
		// 					}
		// 				});
        //             });
                    
		// 		}	

		// 	})
        // });    

        var temp1; $('#search-tbl').on( 'click', 'tr', function (e) 
        {
            console.log('#')
            console.log( table_1.row( this ).data());
            $('#search-tbl > tbody > tr').children('td').css('color','black');
            $('#search-tbl > tbody > tr').children('td').css('background-color','transparent');         
            $(e.currentTarget).children('td').css('background-color','rgba(41, 103, 182, 0.89)');
            $(e.currentTarget).children('td').css('color','white');
            console.log('#')
            temp1=table_1.row( this ).data()      
            console.log('232323')  
            console.log(temp1)  
            console.log('232323')  

            try
             {
                     update_datatable(temp1[0])       
            } catch (e)
             {
                console.log('error in page ')  
          
            }

               
                           
        }); 
	});
</script>

<script src="{% static 'custom_js/accessories.js' %}"></script>
<script src="{% static 'custom_js/cart.js' %}"></script>

<script src="{% static 'custom_js/inventroy_cart.js' %}"></script>

<script src="{% static 'custom_js/sum().js' %}"></script>


<script>

(function($){
    $.widget("suwala.doubleScroll", {
		options: {
            contentElement: undefined, // Widest element, if not specified first child element will be used
			topScrollBarMarkup: '<div class="suwala-doubleScroll-scroll-wrapper" style="height: 20px;"><div class="suwala-doubleScroll-scroll" style="height: 20px;"></div></div>',
			topScrollBarInnerSelector: '.suwala-doubleScroll-scroll',			
			scrollCss: {                
				'overflow-x': 'scroll',
				'overflow-y':'hidden'
            },
			contentCss: {
				'overflow-x': 'scroll',
				'overflow-y':'hidden'
			}
        },		
        _create : function() {
            var self = this;
			var contentElement;

            // add div that will act as an upper scroll
			var topScrollBar = $($(self.options.topScrollBarMarkup));
            self.element.before(topScrollBar);

            // find the content element (should be the widest one)			
            if (self.options.contentElement !== undefined && self.element.find(self.options.contentElement).length !== 0) {
                contentElement = self.element.find(self.options.contentElement);
            }
            else {
                contentElement = self.element.find('>:first-child');
            }

            // bind upper scroll to bottom scroll
            topScrollBar.scroll(function(){
                self.element.scrollLeft(topScrollBar.scrollLeft());
            });
			
            // bind bottom scroll to upper scroll
            self.element.scroll(function(){
                topScrollBar.scrollLeft(self.element.scrollLeft());
            });

            // apply css
            topScrollBar.css(self.options.scrollCss);
            self.element.css(self.options.contentCss);

            // set the width of the wrappers
            $(self.options.topScrollBarInnerSelector, topScrollBar).width(contentElement[0].scrollWidth);
            topScrollBar.width(self.element[0].clientWidth);
        },
        refresh: function(){
            // this should be called if the content of the inner element changed.
            // i.e. After AJAX data load
            var self = this;
			var contentElement;
            var topScrollBar = self.element.parent().find('.suwala-doubleScroll-scroll-wrapper');

            // find the content element (should be the widest one)
            if (self.options.contentElement !== undefined && self.element.find(self.options.contentElement).length !== 0) {
                contentElement = self.element.find(self.options.contentElement);
            }
            else {
                contentElement = self.element.find('>:first-child');
            }

            // set the width of the wrappers
            $(self.options.topScrollBarInnerSelector, topScrollBar).width(contentElement[0].scrollWidth);
            topScrollBar.width(self.element[0].clientWidth);
        }
    });
})(jQuery);


$('#sp_products').closest('.table-responsive').doubleScroll();


$('#showitemid').hide();
vDash= new Vue({
    delimiters: ['[[', ']]'],
    el: '#v-dash',
    data(){
    return {   

            info:{},
            dashInfo:[],
            ret_line_data:[],
            pdi_line_activities:[],
            pdi_line_activities_lov:[],
            pdi_line_id:'',
            ret_line_col:[],
            ret_type:[],
            ret_line_reason_lov:[],
            ret_line_type:[],
            order_line_data:[],
            order_line_col:[],

           
            't':'0',
            'td':'0',
            'tv':'0',
            'gt':'0',
            'vat_p':'',
            'et':'0'

           
        }
    },
    mounted(){
       
       
    },
    computed: {

    },
    methods: {
    }
});

var usingMob = false;
var items = [];

    $("#sales_order_div").hide();
    $('#products').hide();	
    $("#sp_products").bind("paste", function(e){
        var pastedData = e.originalEvent.clipboardData.getData('text');
        if(jQuery.inArray("\r", data) !== -1){
            alert("in if")
        }else{
            testing = pastedData;
            var data = testing.split("\n").filter(x=> x!="").map(x=> !x.trim().includes("\t") ? x.trim()+'/1' :x.trim() );
        }
        rows = data;

        items = rows.map(text=>text.replace("\t","/"));

        quantity = items.map(text=> ({ [text.split("/")[0]]:{quantity:text.split("/")[1]} })).reduce ((a,b) => Object.assign(a,b),{})

        NewArray = items.filter(x=>true);
    
    
       
        $("#excel_data").val(NewArray)
            
        console.log(rows);
        console.log(items);
        console.log(quantity);
        console.log(NewArray);
        // debugger;


        axios.get("/saleswores/search_items?&items="+NewArray)
        .then(function(res)
        {
            console.log(res.data.data)
            console.log(res.data.not_found)
            var html = ""
            var html1 = ""
            customer_vat = $('#customer_vat').val()
            var rowCount = $('#sp_product_id tr').length;
            $.each(quantity, function(index1, value1) {
                $.each(res.data.data, function(index, value) {
                    if($("#"+value.item_code).html()){
                        console.log("in if")
                    }else{
                    
                        if(index1 ==  value.item_code){
                            new_vat = "00.00"
                            if(customer_vat){
                                total = (value1.quantity * Number(value.price).toFixed(2))
                                vat_per = (customer_vat / 100)
                                new_vat = (Number(total).toFixed(2) * Number(vat_per).toFixed(2)) 
                            }
                            discount_val = ""
                            if(value.discount != 0){
                                discount_p= value.discount
                                price = value.price
                                discount = (price * discount_p)
                                selling_price = price - discount
                                discount_val = (discount * value1.quantity).toFixed(2)
                            }else{
                                selling_price = value.price
                                discount_val = "00.00"
                                discount_p = 0
                            }
                            console.log(new_vat)
                                    total_li_price = (value1.quantity * selling_price)
                                    console.log(Number(total_li_price) + Number(new_vat))
                            rowCount =  (rowCount + 1)
                            html += `<tr id=`+value.item_code+`>`
                            html += `<td><button class="delete-item btn btn-sm btn-danger" style="margin-right: 10px;" "+stylehide_btn_remove+"  data-name=`+value.item_code+`><i class="right fas fa-times"></i></button><button   style='display:none;background-color:transparent; font-size: 11px;color: white;padding: 7px 7px;' class=`+value.item_code+` id='blink-bg'></button></td>`
                            html += `<td>`+rowCount+`</td>`
                            html += `<td>`+(value.barcode === null ? "":value.barcode )+`</td>`
                            html += `<td>`+value.item_code+`</td>`
                            html += `<td>`+value.description+`</td>`
                            html += `<td>`+value.primary_unit_of_measure+`</td>`
                            html += '<td id="res_quantity'+value.item_code+'"></td>' 
                            html += `<td> <input type="number" oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');" style="width:50%" id="quantity`+value.item_code+`" item_code="`+value.item_code+`" onblur="updateQuantity(this)" value="`+value1.quantity+`"></td>`
                            html += '<td id="list_price'+value.item_code+'">'+Number(value.price).toFixed(2)+'</td>'
                            html += `<td><input type="number" style="width:50%" id="price`+value.item_code+`" readonly disabled item_code="`+value.item_code+`" onblur="updatePrice(this)" value="`+Number(selling_price).toFixed(2)+`"></td>`
                            html += `<td><input type="number" style="width:50%" id="dis_val${value.item_code}" data-discount="${discount_p}" item_code="${value.item_code}" onblur="updateDiscount(this)" value="${discount_p}" ></td>`
                            {% comment %} html += '<td id="dis_val'+value.item_code+'" data-discount="'+discount_p+'">'+Number(discount_val).toFixed(2)+'</td>' {% endcomment %}
                            html += '<td id="vat'+value.item_code+'">'+Number(new_vat).toFixed(2)+'</td>'
                            html += '<td id="total_price'+value.item_code+'">'+Number(Number(total_li_price) + Number(new_vat)).toFixed(2)+'</td>'
                            html += '<td><input type="hidden" id="total_exc_vat'+value.item_code+'" value="'+Number(selling_price).toFixed(2)+'" /></td>'
                            html += `</tr>`
                        }
                    }
                    
                });
            })
            $('#sp_product_id').append(html)
            console.log(res.data.not_found)
            console.log((res.data.not_found).length)
            $.each(res.data.not_found, function(ind1, val1) {
                console.log(val1)
                if(val1 != ""){
                    if($("#"+val1).closest('tr').attr('id')){
                            console.log("in if")
                    }else{
                        rowCount =  (rowCount + 1)
                        html1 += `<tr style="color:red" id=`+val1+`>`
                        html1 += `<td><button class="delete-item btn btn-sm btn-danger" style="margin-right: 10px;" "+stylehide_btn_remove+"  data-name=`+val1+`><i class="right fas fa-times"></i></button></td>`
                        html1 += `<td>`+rowCount+`</td>`
                        html1 += `<td></td>`
                        html1 += `<td>`+val1+`</td>`
                        html1 += `<td>Not found</td>`
                        html1 += `<td></td>`
                        html1 += `<td></td>`
                        html1 += `<td></td>`
                        html1 += `<td></td>`
                        html1 += `<td></td>`
                        html1 += '<td></td>'
                        html1 += '<td></td>'
                        html1 += '<td></td>'
                        html1 += `</tr>`
                        console.log("=======")
                    }
                }
                });
                $('#sp_product_id').append(html1)
            
            total_records = $('#sp_product_id tr').length;
            $('#total_records').html(total_records)
            $("#sp_products_item_code")[0].value = ""
            var delay = 1000;
            setTimeout(function() {
                getInvoiceTotal()
            },delay)

        })
        .catch(function()
        {
           

        })
        var delay = 1000;
        setTimeout(function() {
            getInvoiceTotal()
        },delay)
    } );
        
$(document).ready(function()
{
    
    id=$('#customer_id_id').val()
    if(id){ 
        text =$('#customer_tet').val()
        customer_name =$('#customer_customer_name').val()
        customer_number =$('#customer_customer_number').val()
        var data ={
            id:id,
            text:text,
            customer_number:customer_number,
            customer_name:customer_name
        };
        var newOption = new Option(data.text, data.id, false, false);
        $('#searchCust').append(newOption).trigger('change');
        $('#searchCust').trigger({
            type: 'select2:select',
            params: {
                data: data
            }
        });

        quotation_items = $('#quotation_item').html()
        console.log(quotation_items)
        row = quotation_items.split(",")
        $.each(row, function(index, value) {
            items.push(value)
        })
        $('#excel_data').val(items)
        console.log(items)
        total_records = $('#sp_product_id tr').length;
        $('#total_records').html(total_records)
    }
// function quotationVat(vat){
//     items_code = []
//     var pastedData = $('#excel_data').val();
//     var data = pastedData.split("\t")
//     $.each(data, function(index, value) {
//         item = value.split(",")
//         $.each(item, function(index1, value1) {
//             var data1 = value1.split("/")
//             items_code.push(data1[0].replace(/\n/g,""))
//         });
//     });
//     customer_vat = $('#customer_vat').val()
//     $.each(items_code, function(index1, value1) {
//         $.each(value1, function(index2, value2) {
//             console.log(value2)
//             new_vat = "00.00"
//             if(customer_vat){
//                 quantity = $('#quantity'+value2).val();
//                 price = $('#price'+value2).val()
//                 total = (quantity * price).toFixed(2)
//                 vat_per = (customer_vat / 100)
//                 new_vat = (total * vat_per).toFixed(2)  
//             }
//             console.log($('#vat'+value2).html())
//             console.log(new_vat)
//             $('#vat'+value2).html(new_vat)
//         })
//     })
//     getInvoiceTotal()
// }

    // if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
    //         usingMob = true;
    // }
    //     shoppingCart.clearCart();
    //     $('#temp_order_number_to_oracle_order').val("");  



    // // var defs= localStorage.getItem('defs')       	  
    // // axios.get("http://192.168.16.150:6323/python_api/get_forms.php?defs="+defs+'&uid=12445')
    // //  .then(function (response) 
    // //  {
    // //      console.log(response)
           
    // //        $('#data').append(response.data);
           
          
    // //  })
    // //  .catch(function (error) {
    // //    // handle error
    // //    alert(error);
    // //  })
    // //  .finally(function () {
    // //    // always executed
    // //  });  
    // FisherMan();
 });


function FisherMan()
{

    var queryString = window.location.search;
    var urlParams = new URLSearchParams(queryString);
    var  discount_id = urlParams.get('discount_id')
    //alert(discount_id)
    if(discount_id!='' &&  discount_id!=null)
    {

                axios.get("fisher_man_validation?discount_id="+discount_id)
                .then(function (response) 
                {
                        console.log(response)
                        dt=response.data

                       if (dt.msg !='null')
                       {
                            toastr.info(dt.msg)
                            return 
                       }


                        var data =
                        {
                            id:dt.cust_account_id,
                            text:dt.customer_name,
                            customer_number:dt.account_number,
                            customer_name:dt.customer_name
                        };

                        var newOption = new Option(data.text, data.id, false, false);
                        
                        $('#searchCust').append(newOption).trigger('change');

                        $('#searchCust').val(dt.cust_account_id).trigger('change');
                        $('#searchCust').select2('data')[0]['customer_name']=dt.customer_name;
                        $('#searchCust').select2('data')[0]['customer_number']=dt.account_number;


                        document.getElementById('main_cust').value=dt.customer_name;
                        document.getElementById('main_customer_number').value=dt.customer_number;
                        document.getElementById('main_customer_id').value=dt.cust_account_id;     

                        
                        

                        // var newOption = new Option(dt.customer_name, dt.cust_account_id, false, false);
                        // $('#searchCust').append(newOption).trigger('change');

                        $('#customer').append('<option value="'+dt.cust_account_id+'">'+dt.customer_name+'</option>')

                        $('#customer_bill').append('<option value="'+dt.cust_account_id+'">'+dt.customer_name+'</option>')


                        // $('#searchCust').val(dt.cust_account_id).trigger('change') 

                        // $('#searchCust').select2('data')[0]['customer_name']=dt.customer_name;
                        // $('#searchCust').select2('data')[0]['customer_number']=dt.customer_number;


                     


                        $('#customer').val(dt.cust_account_id);

                        $('#customer_bill').val(dt.cust_account_id);

                        $('#shiptocust').val(dt.customer_name)

                        $('#billtocust').val(dt.customer_name)

                        $('#sel_cust').html(dt.customer_name);


                        cust_disc_perc= dt.cust_disc_perc

                        actual_bal_amount= (parseFloat(dt.actual_bal_amount)).toFixed(2) 

                        customer_limit= (parseFloat(dt.customer_limit)).toFixed(2) 

                        $('#sel_cust').prepend(' <br>Discount Max Percentage :'+ cust_disc_perc+' <br>'); 

                        $('#sel_cust').prepend('Available Limit (AED): '+ actual_bal_amount+' ');

                        

                       // 16: show place holder on the input fields 

                        $('#avlable_stock').prepend("<marquee>This customer is selected for disacount</marquee>")

                        $('#cust_disc_perc').val(cust_disc_perc)


                        $('#discount_id').val(discount_id)


                        

                        $('#actual_bal_amount').val(actual_bal_amount);
                        $('#customer_limit').val(customer_limit);

                        //


                        $('#searchCust').prop('disabled', true);
                        $('#customer').prop('disabled', true);
                        $('#customer_bill').prop('disabled', true);


                        
                        cust_account_id_(dt.cust_account_id)
                       
                        //get_tax_()

                        

                })
                .catch(function (error) 
                {
                        alert(error);
                })
                .finally(function () 
                {
               
                });  

    }


}



var selected_customer=''
function cust_account_id_(id)
{
    //alert(1)
    axios.get("/sales/get-customer-data?caid="+id+"&defs="+localStorage.getItem('defs'))
      .then(function(res)
      {
  
         //customer_infoo
        
         document.getElementById('customer_infoo').innerHTML='<div class="row" id="customer_infoo_tbl" hidden> <label for="name" class="col-sm-4" style="margin-bottom:0px" >Name :</label><span class="col-sm-8"  >'+res.data.hdr.customer_name+'</span></div><div class=" row"><label class="col-sm-4"  for="name" style="margin-bottom:0px"> Customer #: </label><span  class="col-sm-8"   style="color: #007bff;text-decoration: none; background-color: transparent;cursor: pointer;" onclick="customer_history('+ res.data.hdr.account_number +')" >'+ res.data.hdr.account_number +'</span></div> <div class=" row "><label class="col-sm-4"  for="name" style="margin-bottom:0px">Email :</label><span class="col-sm-8"  >'+res.data.hdr.email_id+'</span></div><div class=" row "><label style="margin-bottom:0px" for="name" class="col-sm-4"> Mobile : </label><span class="col-sm-8" >'+res.data.hdr.mob_no+'</span></div>';
         //$('#sel_cust').html(res.data.hdr.customer_name);
      
      //document.getElementById('selected_cust').innerHTML='<b> Customer Name :</b> '+res.data.hdr.customer_name+'<br>';
  
      //document.getElementById('selected_cust_account').innerHTML='<b> Customer Number :</b>'+ res.data.hdr.account_number+'<br>';
  
  
     // document.getElementById('selected_cust_email').innerHTML='<b> Customer Email :</b> '+res.data.hdr.email_id+'<br>';
  
     // document.getElementById('selected_cust_phone').innerHTML='<b> Customer Mobile :</b> '+res.data.hdr.mob_no;
  
      
      
  
      //console.log(res.data)
      selected_customer=res.data;           
  
    //   for (var k in formDetails.data)
    //   {
    //   if (formDetails.data[k] == null)
    //   {
    //          formDetails.data[k] = '-';
    //   }
    //   }
  
          //http://lp00735/cust/get-customer-data?caid=3579
      $("#available_customer_address_div").removeClass('d-none');    
      var out='';
      for(var i=0;i<res.data.lines_data.data.length;i++)
      {
             // out+='<option value="'+res.data.lines_data.data[i][2]+'">'+res.data.lines_data.data[i][2]+'</option>';
  
             // alert(res.data.lines_data.data[i][9])
  
      if(res.data.lines_data.data[i][9]=='SHIP_TO')
      {   
          var $select = $('#customer');
          $select.empty();                     
          $select.append("<option value="+res.data.lines_data.data[0][14]+">"+res.data.lines_data.data[0][12]+"</option>"); 
  
  
        //   var $select = $('#number');
        //   $select.empty();                     
        //   $select.append("<option value="+res.data.lines_data.data[0][11]+">"+res.data.lines_data.data[0][11]+"</option>"); 
  
  
                  // document.getElementById('number').value=res.data.lines_data.data[i][11];
  
  
                  //document.getElementById('customer').value=res.data.hdr_data.data[0][7];
                //   document.getElementById('location').value=res.data.lines_data.data[i][10];
  
                //   document.getElementById('address').value=res.data.lines_data.data[i][2];
                //   document.getElementById('address_2').value=res.data.lines_data.data[i][3];
                //   document.getElementById('address_3').value=res.data.lines_data.data[i][4];
  
                //   document.getElementById('area').value=res.data.lines_data.data[i][6];
                //   document.getElementById('country').value=res.data.lines_data.data[i][8];
                //   document.getElementById('contact').value=res.data.lines_data.data[i][13];
                 // alert(3333)
                 // alert(2)
                //   console.log(res.data.lines_data.data[i])

                
               // document.getElementById('ship_to_customer_infoo').innerHTML='<div class=" row" id="customer_infoo_tbl"> <label for="name" class="col-sm-4" >Name :</label><span class="col-sm-8"  >'+res.data.hdr.customer_name+'</span></div><div class=" row"><label class="col-sm-4"  for="name"> Customer #: </label><span  style="color: #007bff;text-decoration: none; background-color: transparent;cursor: pointer;" onclick="customer_history('+ res.data.hdr.account_number +')" >'+ res.data.hdr.account_number +'</span></div> <div class=" row "><label class="col-sm-4"  for="name">Email :</label><span>'+res.data.hdr.email_id+'</span></div><div class=" row "><label for="name" class="col-sm-4"> Mobile : </label><span>'+res.data.hdr.mob_no+'</span></div>';
  
                document.getElementById('ship_to_customer_infoo').innerHTML='<div class=" row" id="customer_infoo_tbl" hidden> <label for="name" class="col-sm-4" style="margin-bottom:0px">Name :</label><span class="col-sm-8"  >'+res.data.hdr.customer_name+'</span></div><div class=" row"><label class="col-sm-4"  for="name" style="margin-bottom:0px"> Customer #: </label><span  class="col-sm-8"   style="color: #007bff;text-decoration: none; background-color: transparent;cursor: pointer;" onclick="customer_history('+ res.data.hdr.account_number +')" >'+ res.data.hdr.account_number +'</span></div> <div class=" row "><label class="col-sm-4"  for="name" style="margin-bottom:0px">Email :</label><span class="col-sm-8"  >'+res.data.hdr.email_id+'</span></div><div class=" row "><label for="name" class="col-sm-4" style="margin-bottom:0px"> Mobile : </label><span class="col-sm-8" >'+res.data.hdr.mob_no+'</span></div>';
  
                $('#shiptocust').val(res.data.hdr.customer_name)
               
                
               }
  
               if(res.data.lines_data.data[i][9]=='BILL_TO')
              {
                  
                  //alert(1)
                 // console.log(res.data.lines_data.data[i])
                 // alert(res.data.lines_data.data[i][12])
  
                  var $select = $('#customer_bill');
                  $select.html('');                     
                  $select.append("<option value="+res.data.lines_data.data[i][14]+">"+res.data.lines_data.data[i][12]+"</option>"); 
  
  
                //    var $select_1 = $('#number_bill');
                //    $select_1.empty();                     
                //    $select_1.append("<option value="+res.data.lines_data.data[i][11]+">"+res.data.lines_data.data[i][11]+"</option>"); 
                  
  
                 // document.getElementById('customer_bill').value=res.data.hdr_data.data[0][7] || '';
                //   document.getElementById('location_bill').value=res.data.lines_data.data[i][10] || '';                   
                //   document.getElementById('address_bill').value=res.data.lines_data.data[i][2] || '';                                     
                  //document.getElementById('address_2_bill').value=res.data.lines_data.data[i][3] || '';                   
                  //document.getElementById('address_3_bill').value=res.data.lines_data.data[i][4] || '';                   
                //   document.getElementById('area_bill').value=res.data.lines_data.data[i][6] || '';
                 
                 /// document.getElementById('country_bill').value=res.data.lines_data.data[i][8] || '';
                //   document.getElementById('contact_bill').value=res.data.lines_data.data[i][13] || '';
                  
                document.getElementById('bill_to_customer_infoo').innerHTML='<div class=" row" id="customer_infoo_tbl"> <label for="name" class="col-sm-4" >Name :</label><span class="col-sm-8"  >'+res.data.hdr.customer_name+'</span></div><div class=" row"><label class="col-sm-4"  for="name"> Customer #: </label><span  class="col-sm-8"   style="color: #007bff;text-decoration: none; background-color: transparent;cursor: pointer;" onclick="customer_history('+ res.data.hdr.account_number +')" >'+ res.data.hdr.account_number +'</span></div> <div class=" row "><label class="col-sm-4"  for="name">Email :</label><span class="col-sm-8"  >'+res.data.hdr.email_id+'</span></div><div class=" row "><label for="name" class="col-sm-4"> Mobile : </label><span class="col-sm-8" >'+res.data.hdr.mob_no+'</span></div>';
  
                $('#billtocust').val(res.data.hdr.customer_name)
  
               }
  
  
  
              
              // alert(123)
  
  
          }
  
         // document.getElementById('available_customer_address').innerHTML=out;
         // $('#available_customer_address').select2(); 
          //
         // alert(res.data.lines_data.data.length)
         // available_customer_address
       
         
      })
      .catch(function(){
          //$('#viewCust').unblock();
         // $('#v-form-detail').hide();
  
      })


}
</script>



<script>

function draft_addRow(tableID) {
            //alert(tableID)
			var table_cash = document.getElementById(tableID);
			var rowCount = table_cash.rows.length;			
			var row = table_cash.insertRow(rowCount);
			var colCount = table_cash.rows[0].cells.length;
			for(var i=0; i<colCount; i++) 
            {	
               // alert(rowCount)		

                //alert(table_cash.rows[i+1].cells[1].childNodes[0].value)

			// if(rowCount >= 3) 
			// {
			// 	table_cash.deleteRow(rowCount);
			// 	alert("Cannot add the rows more then 2.");
			// 	break;					
			// }

			//onkeyup="this.value = minmax(this.value,0, 1000000)"
				var newcell	= row.insertCell(i);
				newcell.innerHTML = table_cash.rows[1].cells[i].innerHTML;
				//alert(newcell.childNodes[0].type);
				switch(newcell.childNodes[0].type) {
					case "text":
							newcell.childNodes[0].value = "";
							newcell.childNodes[0].id="text"+rowCount;	
							newcell.childNodes[0].disabled=false;							
							break;
					case "checkbox":
							newcell.childNodes[0].checked = false;
							break;
					case "select-one":
							newcell.childNodes[0].selectedIndex =0;
						    newcell.childNodes[0].id='select'+i;	
							break;
					case "number":
							newcell.childNodes[0].value = "";
							newcell.childNodes[0].id="number"+rowCount;	
                            newcell.childNodes[0].class="sun_rec";	
							//newcell.childNodes[0].onkeyup = "this.value = minmax(this.value,0, 1000000)";
							break;
				}
			}
            draft_line_type_change();
            
		}


		
		function draft_selectval(id)
		{
		    		   
		    var sel=document.getElementById(id);
			var opt = sel.options[sel.selectedIndex];			 
					   
		   //alert(opt.text);
		   if(opt.text=="CASH")
		   {
		   document.getElementById("text"+id).disabled = true;
		   }
		   else
		   {
		   document.getElementById("text"+id).disabled = false;
		   } 
		   
		   
		   
		
		}
		
		function draft_deleteRow(tableID) {
			try {
			var table_cash = document.getElementById(tableID);
			var rowCount = table_cash.rows.length;
			for(var i=0; i<rowCount; i++) {
				var row = table_cash.rows[i];
				var chkbox = row.cells[0].childNodes[0];
				if(null != chkbox && true == chkbox.checked) {
					if(rowCount <= 1) 
					{
						alert("Cannot delete all the rows.");
						break;
					}
					table_cash.deleteRow(i);
					rowCount--;
					i--;
				}


			}
			}catch(e) 
			{
				
                alert(e);
			}
            draft_line_type_change()
		}

		function addRow(tableID) {
			var table = document.getElementById(tableID);
			var rowCount = table.rows.length;			
			var row = table.insertRow(rowCount);
            var colCount = table.rows[0].cells.length;
            var count=0;
            for(var i=0; i<colCount; i++) 
            {			

			// if(rowCount >= 2) 
			// {
			// 	table.deleteRow(rowCount);
			// 	alert("Cannot add the rows more then 2.");
			// 	break;					
			// }
			//onkeyup="this.value = minmax(this.value,0, 1000000)"
                var newcell	= row.insertCell(i);
                count++
               
                if(i==0)
                {
                   
                    newcell.innerHTML =rowCount;
                }
                else if(i==6)
                {
                    
                    newcell.innerHTML ='<a class="btn btn-xs delete-record"  v-bind:did="index+row.line_id"   onclick="deleteRow(this)">Delete</a>'
                }
                else
                {
                    
                    newcell.innerHTML = table.rows[1].cells[i].innerHTML;
                }
				
				//alert(newcell.childNodes[0].type);
				// switch(newcell.childNodes[0].type) {
				// 	// case "text":
				// 	// 		newcell.childNodes[0].value = "";
				// 	// 		newcell.childNodes[0].id="text"+rowCount;	
				// 	// 		newcell.childNodes[0].disabled=false;							
				// 	// 		break;					
				// 	// case "select-one":
				// 	// 		newcell.childNodes[0].selectedIndex = 1;
				// 	// 	    newcell.childNodes[0].id=rowCount;	
				// 	// 		break;
				// 	// case "number":
				// 	// 		newcell.childNodes[0].value = "";
				// 	// 		newcell.childNodes[0].id="number"+rowCount;	
				// 			//newcell.childNodes[0].onkeyup = "this.value = minmax(this.value,0, 1000000)";
				// 			break;
				// }
			}
		}


		
		function selectval(id)
		{
		    		   
		    var sel=document.getElementById(id);
			var opt = sel.options[sel.selectedIndex];			 
					   
		   //alert(opt.text);
		   if(opt.text=="CASH")
		   {
		   document.getElementById("text"+id).disabled = true;
		   }
		   else
		   {
		   document.getElementById("text"+id).disabled = false;
		   } 
		   
		   
		   
		
		}
		
		function deleteRow(thizz) {
            // try 
            // {

           
            line_to_removed=$(thizz).attr("did");

            $(thizz).closest('tr').remove();
           // $('#'+line_to_removed).remove();

			// var table = document.getElementById('pdi_line_act');
			// var rowCount = table.rows.length;
            // for(var i=0; i<rowCount; i++) 
            // {
			// 	var row = table.rows[i];
			// 	var chkbox = row.cells[0].childNodes[0];
			// 	if(null != chkbox && true == chkbox.checked) {
			// 		if(rowCount <= 1) 
			// 		{
			// 			alert("Cannot delete all the rows.");
			// 			break;
			// 		}
			// 		table.deleteRow(i);
			// 		rowCount--;
			// 		i--;
			// 	}


			// }
			// }catch(e) 
			// {
		 	// alert(e);
			// }
            }
            
shoppingCart.clearCart();           
      
      
$(document).on('click','.btn-item',function(event) {
    // if ($(this).index() == 0) return;
    var d = $(this).closest('table').DataTable().row($(this).closest('tr')).data();
    axios.defaults.xsrfHeaderName = "X-CSRFTOKEN";
    axios.defaults.xsrfCookieName = "csrftoken";
    axios.defaults.withCredentials = true;
    axios.post("/saleswores/get_reservation_det",d)
    .then(function(res){
        $('#reservation_detail').modal('show');
        $('#rdtl').empty().append(res.data[0]);
    })



})

 

$(document).on('click','.add-to-cart',function(event) {
    
    event.preventDefault();
    var dtApi = $(this).closest('table').DataTable();
    var rowData = $(this).closest('table').DataTable().row($(this).closest('tr')).data();
    console.log(rowData);
    var obj = {};
    Object.keys(rowData).forEach(function(key)
    {
        obj[key] = rowData[key];
    });
    /*
    Validatinig selected item's age
    */
    obj['current_org'] = JSON.parse(localStorage.getItem('defs')).organization_code;

    // obj['code'] = rowData.inventory_item_id + rowData.color.trim() + rowData.model_year.trim();
    rowData['serial_number'] = rowData['barcode'] + rowData['item_code'] + rowData['organization_code'];
    rowData['serial_number'] = rowData.organization_id;
    obj['name'] = rowData.inventory_item_id + rowData.organization_id;
    obj['name'] = obj['name'].trim();
    // $('#'+obj['name']).hide();
    obj['item_code'] = rowData.item_code;
    obj['organization_code'] = rowData.organization_code;
    obj['org_id'] = rowData.org_id;
    obj['organization_id'] = rowData.organization_id;
    obj['from_org_name'] = rowData.organization_name;
    // obj['serial_number'] = rowData.barcode+rowData.item_code+rowData.organization_code;
    obj['inventory_item_id'] = rowData.inventory_item_id;
    obj['onhand_qty'] = rowData.reservable_qty;
    obj['vin_price'] = rowData.vin_price;
    obj['item_type'] = rowData.item_type;
    obj['comment'] = "";
    obj['required_date'] = moment().add(0.5,'hours').format("DD-MMM-YYYY hh:mm:ss a").toUpperCase();

    // moment().format("DD-MMM-YYYY HH:mm:ss a").toUpperCase()
    var price = Number(0);


    flyToCart($(this).closest('tr')[0]);
    invTransfersCart.addItemToCart_invTransfersCart(obj, price, 1);
    dtApi.draw(false);
//   if(rowData.stock_status=='Available'){

//   } else {
//     alert('Stock status is not available');
//   }


  inv_trnfdisplayCart();
});


function inv_trnfdisplayCart() {
  var cartArray = invTransfersCart.listCart();
//   stepsCompnent.tab1.count = invTransfersCart.totalCount();
  $('.inv_transfer_qty_selected').html(invTransfersCart.totalCount());

  if (cartArray.length == 0){
    $('.show-cart').empty();
    $('.cart-tot').remove();
    $('.cart-zero').remove();
    $('.show-cart').after('<h4 class="cart-zero">Cart is empty.</h4>');
    $('.inv_transfer_qty_selected').html(invTransfersCart.totalCount());
    return;
  }

}
      
invTransfersCart.clearCart();




$( document ).ready(function() 
{  
    console.log("ready!");   

    setTimeout(() => {get_order_type_lov()}, 1000);

});



$(document).on('change', '#cash_collection select[name=country]' ,function(){
    // alert()
    if (this.value == 'CASH'){
        $(this).closest('tr').find('td:nth(3) input').val("")
    }
});

$("#sp_products_item_code").on( "keyup", function(e) {
    var q = $('#sp_products_item_code').val();
    if ($('#sp_products_item_code').val().length < 3 ) {
        $('#showitemid').hide()
    }else{
        var item_html = ""
        console.log("hhhhhhhhhh")
        axios.get("/saleswores/search_items?&q="+q)
            .then(function(res)
            {

                if((res.data.data).length != 0){
                    $.each(res.data.data, function(index, value) {
                        item_html += `<a>`
                        item_html += `<div id=`+value.item_code+` style="background-color: aliceblue;" onclick=addInTable("`+value.item_code+`")>`
                        item_html += `<b> Barcode :</b> `+value.barcode+`<br>`
                        item_html += `<b> Item Code : </b> `+value.item_code+`<br>`
                        item_html += `<b> Description : </b> `+value.description+`<br>`
                        item_html += `</div>`
                        item_html += `</a>`
                        item_html += `<hr class="bg-dark m-0">`
                        
                    });
                }
                else{
                    $('#showitemid').hide()
                //     item_html += `<div style="background-color: red;">`
                //     item_html += `No Item Found`
                //     item_html += `</div>`
                }
                $('#showitemid').html(item_html)
                $('#showitemid').show()
            })

            .catch(function()
            {
               

            })
    }
    if (e.key === 'Enter' || e.keyCode === 13 || e.key === 'ArrowDown' || e.keyCode === 40) {
        console.log("also running")
        col_value = $('#sp_products_item_code').val()
        if(col_value){
            items_code_array = items
            $('#sp_products_item_code').val('');
            $('#showitemid').hide()
            var tr_html = ""
            if(jQuery.inArray(col_value, items_code_array) !== -1){
            }else{
                var html= ""
                var html1 = ""
                // if($("#new_excel_data").val()){
                //     items = $("#new_excel_data").val()
                //     console.log(items)
                //     items= items.split(",")
                // }
                row_data = col_value.split("\t")
                console.log(row_data)
                item=row_data[0]+'/1'
                items.push(item)
                console.log(items)
                var NewArray = items.filter(function(element,index,self){
                    return index === self.indexOf(element); 
                });

                console.log(NewArray);
                $('#excel_data').val(NewArray);
                console.log(items)
                quantity = {}
                $.each(items, function(data_index, data_value) {
                    items_array = data_value.split("/")
                    quantity[items_array[0]] = {
                        'quantity': items_array[1]
                    }
                    
                });
                console.log("enter in")
                axios.get("/saleswores/search_items?&items="+col_value)
                .then(function(res)
                {
                    customer_vat = $('#customer_vat').val()
                    var rowCount = $('#sp_product_id tr').length;
                    $.each(quantity, function(index1, value1) {
                        $.each(res.data.data, function(index, value) {
                            console.log(value)
                            if($("#"+value.item_code).closest('tr').attr('id')){
                            }else{
                                if(index1 ==  value.item_code){
                                    new_vat = "00.00"
                                    if(customer_vat){
                                        total = (value1.quantity * Number(value.price).toFixed(2))
                                        console.log(total)
                                        vat_per = (customer_vat / 100)
                                        console.log(vat_per)
                                        new_vat = Number(total * vat_per).toFixed(2)
                                        console.log(new_vat)
                                    }
                                    discount_val = "00.00"
                                    if(value.discount != 0){
                                        discount_p= value.discount
                                        price = value.price
                                        discount = (price * discount_p)
                                        selling_price = price - discount
                                        discount_val = (discount * value1.quantity).toFixed(2)
                                    }else{
                                        selling_price = value.price
                                        discount_p = 0
                                    }
                                    console.log(new_vat)
                                    total_li_price = (value1.quantity * selling_price)
                                    console.log(Number(total_li_price) + Number(new_vat))
                                    rowCount =  (rowCount + 1)
                                    html += `<tr id=`+value.item_code+`>`
                                    html += `<td><button class="delete-item btn btn-sm btn-danger" style="margin-right: 10px;" "+stylehide_btn_remove+"  data-name=`+value.item_code+`><i class="right fas fa-times"></i></button></td>`
                                    html += `<td>`+rowCount+`</td>`
                                    html += `<td>`+value.barcode+`</td>`
                                    html += `<td>`+value.item_code+`</td>`
                                    html += `<td>`+value.description+`</td>`
                                    html += `<td>`+value.primary_unit_of_measure+`</td>`
                                    html += '<td></td>'
                                    html += `<td> <input type="number" oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');" style="width:50%" id="quantity`+value.item_code+`" item_code="`+value.item_code+`" onblur="updateQuantity(this)" value="`+value1.quantity+`"></td>`
                                    html += '<td id="list_price'+value.item_code+'">'+Number(value.price).toFixed(2)+'</td>'
                                    html += `<td><input type="number" style="width:50%" id="price`+value.item_code+`" readonly disabled item_code="`+value.item_code+`" onblur="updatePrice(this)" value="`+Number(selling_price).toFixed(2)+`"></td>`
                                    html += `<td><input type="number" style="width:50%" id="dis_val${value.item_code}" data-discount="${discount_p}" item_code="${value.item_code}" onblur="updateDiscount(this)" value="${discount_p}" ></td>`
                                    {% comment %} html += '<td id="dis_val'+value.item_code+'" data-discount="'+discount_p+'">'+Number(discount_val).toFixed(2)+'</td>' {% endcomment %}
                                    html += '<td id="vat'+value.item_code+'">'+Number(new_vat).toFixed(2)+'</td>'
                                    html += '<td id="total_price'+value.item_code+'">'+(Number(total_li_price) + Number(new_vat)).toFixed(2)+'</td>'
                                    html += '<td><input type="hidden" id="total_exc_vat'+value.item_code+'" value="'+Number(selling_price).toFixed(2)+'" /></td>'
                                    html += `</tr>`
                                    $('#total_records').html(rowCount)
                                }
                            }
                            var delay = 2000;
                            setTimeout(function() {
                                getInvoiceTotal()
                            },delay)
                        });
                    })
                    $('#sp_product_id').append(html)
                    $.each(res.data.not_found, function(index1, value1) {
                        if($("#"+value1).closest('tr').attr('id')){
                        }else{
                            rowCount = rowCount + 1
                            html1 += `<tr style="color:red" id=`+value1+`>`
                            html1 += `<td><button class="delete-item btn btn-sm btn-danger" style="margin-right: 10px;" "+stylehide_btn_remove+"  data-name=`+value1+`><i class="right fas fa-times"></i></button></td>`
                            html1 += `<td>`+rowCount+`</td>`
                            html1 += `<td></td>`
                            html1 += `<td>`+value1+`</td>`
                            html1 += `<td>Not found</td>`
                            html1 += `<td></td>`
                            html1 += `<td></td>`
                            html1 += `<td></td>`
                            html1 += `<td></td>`
                            html1 += `<td></td>`
                            html1 += '<td></td>'
                            html1 += '<td></td>'
                            html1 += '<td></td>'
                            html1 += `</tr>`
                            $('#total_records').html(rowCount)
                        }
                    });
                    $('#sp_product_id').append(html1)
                })
                .catch(function()
                {
                   

                })
            }
        }
    }
});


function addInTable(item_code, quotation=false){
    var tr_html = ""
    var html = ""
    $('#showitemid').hide()
    if(jQuery.inArray(item_code, items) !== -1){
        $("#sp_products_item_code")[0].value = ""
    }else{
        $('#showitemid').hide()
        row_data = item_code.split("\t")
        console.log(row_data)
        if(row_data[1] && quotatio){
        }else{
            item=row_data[0]+'/1'
        }
        items.push(item)
        var NewArray = items.filter(function(element,index,self){
            return index === self.indexOf(element); 
        });

        console.log(NewArray);
        var data = $('#excel_data').val(NewArray);
        console.log(data)
        quantity = {}
        $.each(items, function(data_index, data_value) {
            items_array = data_value.split("/")
            quantity[items_array[0].replace(/\n/g,"")] = {
                'quantity': items_array[1]
            }
            
        });
        console.log("addInTABLE")
        axios.get("/saleswores/search_items?&items="+item_code)
        .then(function(res)
        {
            customer_vat = $('#customer_vat').val()
            var rowCount = $('#sp_product_id tr').length;
            $.each(quantity, function(index1, value1) {
                $.each(res.data.data, function(index, value) {
                    console.log(value)
                     if($("#"+value.item_code).closest('tr').attr('id')){
                    }else{
                        if(index1 ==  value.item_code){
                            new_vat = "00.00"
                            if(customer_vat){
                                total = (value1.quantity * value.price).toFixed(2)
                                console.log(total)
                                vat_per = (customer_vat / 100)
                                console.log(vat_per)
                                new_vat = (total * vat_per).toFixed(2)
                                console.log(new_vat)  
                            }
                            
                            console.log(new_vat)
                            discount_val = "00.00"
                            if(value.discount != 0){
                                discount_p= value.discount
                                price = value.price
                                discount = (price * discount_p)
                                selling_price = price - discount
                                discount_val = (discount * value1.quantity).toFixed(2)
                            }else{
                                selling_price = value.price
                                discount_p = 0
                            }
                            console.log(new_vat)
                            total_li_price = (value1.quantity * selling_price)
                            console.log(Number(total_li_price) + Number(new_vat))
                            rowCount =  (rowCount + 1)
                            html += `<tr id=`+value.item_code+`>`
                            html += `<td><button class="delete-item btn btn-sm btn-danger" style="margin-right: 10px;" "+stylehide_btn_remove+"  data-name=`+value.item_code+`><i class="right fas fa-times"></i></button></td>`
                            html += `<td>`+rowCount+`</td>`
                            html += `<td>`+value.barcode+`</td>`
                            html += `<td>`+value.item_code+`</td>`
                            html += `<td>`+value.description+`</td>`
                            html += `<td>`+value.primary_unit_of_measure+`</td>`
                            html += '<td></td>' 
                            html += `<td> <input type="number" oninput="event.target.value = event.target.value.replace(/[^0-9]*/g,'');" style="width:50%" id="quantity`+value.item_code+`" item_code="`+value.item_code+`" onblur="updateQuantity(this)" value="`+value1.quantity+`"></td>`
                            html += '<td id="list_price'+value.item_code+'">'+Number(value.price).toFixed(2)+'</td>'
                            html += `<td><input type="number" style="width:50%" id="price`+value.item_code+`" readonly disabled item_code="`+value.item_code+`" onblur="updatePrice(this)" value="`+Number(selling_price).toFixed(2)+`"></td>`
                            html += `<td><input type="number" style="width:50%" id="dis_val${value.item_code}" item_code="${value.item_code}" onblur="updateDiscount(this)" data-discount="${discount_p}" value="${Number(discount_val).toFixed(2)}"></td>`
                            {% comment %} html += '<td id="dis_val'+value.item_code+'"  data-discount="'+discount_p+'">'+Number(discount_val).toFixed(2)+'</td>' {% endcomment %}
                            html += '<td id="vat'+value.item_code+'">'+Number(new_vat).toFixed(2)+'</td>'
                            html += '<td id="total_price'+value.item_code+'">'+Number(Number(total_li_price) + Number(new_vat)).toFixed(2)+'</td>'
                            html += '<td><input type="hidden" id="total_exc_vat'+value.item_code+'" value="'+Number(selling_price).toFixed(2)+'" /></td>'
                            html += `</tr>`
                            $('#total_records').html(rowCount)
                        }
                        var delay = 2000;
                        setTimeout(function() {
                            getInvoiceTotal()
                        },delay)
                    }
                });
            })
            $('#sp_product_id').append(html)
        })
        .catch(function(err)
        {
            console.log(' error at 3958', err)
        })
    }
    $("#sp_products_item_code")[0].value = ""
}

function updateQuantity(a){
    console.log('updateQuantity(a)');
    thizzzzzzzz=a;
    var inpQty=$(a).val();
    var req_item_code = thizzzzzzzz.getAttribute('item_code')
    var res_quantity = thizzzzzzzz.getAttribute('res_quantity')
    let inpDis=$('#dis_val'+req_item_code).val();

    var listPrice=parseFloat($("#list_price"+req_item_code).text());
    $("#price"+req_item_code).val(listPrice  * parseFloat(inpQty));

    
    res_quantity = $('#res_quantity'+req_item_code).html()
    discount_val = $('#dis_val'+req_item_code).attr("data-discount");
    if(res_quantity){
        if(res_quantity < inpQty){
            $('#quantity'+req_item_code).attr('max', res_quantity)
            $(a).val(res_quantity);
        }
    }
    price = parseFloat($('#list_price'+req_item_code).text())
    new_price = parseFloat(inpQty * price) - parseFloat(inpDis)
    $('#total_price'+req_item_code).html((new_price).toFixed(2))

    list_price = $('#list_price'+req_item_code).html()
    new_discount = ((list_price * inpQty)* discount_val)
    $('#dis_val'+req_item_code).html((new_discount).toFixed(2))

    customer_vat = $('#customer_vat').val()
    const dissss = parseFloat($('#dis_val'+req_item_code).val())
        if(customer_vat){
            total = ((inpQty * price)- dissss).toFixed(2)
            vat_per = (customer_vat / 100)
            new_vat = (total * vat_per).toFixed(2)
            $('#vat'+req_item_code).html(new_vat)
            total_price = $('#total_price'+req_item_code).html()
            add_new_vat = (parseFloat(total_price) + parseFloat(new_vat))
            $('#total_price'+req_item_code).html(add_new_vat)
            
        }
    
    data = $('#excel_data').val()
    console.log('4014 excel_data', data)
    tst = data.split(",")
    items_code = []
    $.each(tst, function(data_index1, data_value1) {
        items_array = data_value1.split("/")
        if(items_array[0].replace(/\n/g,"") == req_item_code){
            item=items_array[0]+'/'+inpQty
        }else{
            item=items_array[0]+'/'+items_array[1]
        }
        items_code.push(item)
    })
    items = items_code
    $('#excel_data').val(items_code)
    var delay = 1000;
        setTimeout(function() {
        getInvoiceTotal(items_code)
    },delay)
}


function updateDiscount(a){
        const _customer_vat = $('#customer_vat').val() || 0
        console.log('iNSISISISIS UPDATE DISCOUNT');
        const inpDis=parseFloat($(a).val());
        const req_item_code = a.getAttribute('item_code')
        const quan=parseFloat($("#quantity"+req_item_code).val());
        const listPrice=parseFloat($("#list_price"+req_item_code).text());
        const vat=parseFloat($("#vat"+req_item_code).text());
        $('#dis_val'+req_item_code).attr("data-discount", inpDis);
        $('#dis_val'+req_item_code).attr("value", inpDis);
        $("#price"+req_item_code).val(listPrice  * quan);   //GROSS WITHOUT DISCOUNT
        const total_exc_vat = (listPrice  * quan) - inpDis;
        $("#total_exc_vat"+req_item_code).val(total_exc_vat);  //GROSS WITH DISCOUNT WITHOUT VAT
        const new_vat = total_exc_vat*(parseFloat(_customer_vat)/100)
        $("#vat"+req_item_code).text(new_vat.toFixed(2))
        $('#total_price'+req_item_code).text(total_exc_vat + new_vat);  //LINE TOTAL
        getInvoiceTotal()
    }


function updatePrice(a){
    var req_item_code = a.getAttribute('item_code')
    var eee = 'Selling price of the item in line number is less then list price  ';
    // line_popover_error(req_item_code,eee);
    // $('.'+req_item_code).html('&#9432;'); 
    //         $('.'+req_item_code).css("background-color", "red");
    //         $('.'+req_item_code).css("display", "initial");
    var inpQty=$('#quantity'+req_item_code).val();
    let inpDis=$('#dis_val'+req_item_code).val();
    price = $('#price'+req_item_code).val()
    new_price = parseFloat(inpQty * price) - parseFloat(inpDis)
    var delay = 1000;
     customer_vat = $('#customer_vat').val();
    setTimeout(function() {
    if(customer_vat){
        quantity = $('#quantity'+req_item_code).val();
        price = parseFloat($('#list_price'+req_item_code).text())
        total = (quantity * price).toFixed(2)
        vat_per = (customer_vat / 100)
        new_vat = (total * vat_per).toFixed(2)  
    }
    newPrice = parseFloat(new_price) + parseFloat(new_vat)

    console.log("newPrice",newPrice)
    $('#vat'+req_item_code).html(new_vat)
    $('#total_price'+req_item_code).html((newPrice).toFixed(2))
    getInvoiceTotal()
    },delay)
}

function updateVat(vat){
    items_code = []
    var pastedData = $('#excel_data').val();
    var data = pastedData.split("\t")
    $.each(data, function(index, value) {
        item = value.split(",")
        $.each(item, function(index1, value1) {
            var data1 = value1.split("/")
            items_code.push(data1[0].replace(/\n/g,""))
        });
    });
    customer_vat = $('#customer_vat').val()
    $.each(items_code, function(index1, value1) {
        new_vat = "00.00"
        if(customer_vat){
            quantity = $('#quantity'+value1).val()
            price = parseFloat($('#list_price'+value1).text())
            total = (quantity * price).toFixed(2)
            vat_per = (customer_vat / 100)
            new_vat = (total * vat_per).toFixed(2)  
        }
        line_total = $('#total_price'+value1).html()
        $('#vat'+value1).html(new_vat)
        to_pr = parseFloat(line_total) + parseFloat(new_vat)
        $('#total_price'+value1).html((to_pr).toFixed(2))

    })
    getInvoiceTotal()
}



function getInvoiceTotal(){
    total_line_price = 0
    total_line_vat = 0
    let total_discount = 0
    let grand_line_total_only_items = 0;
    $('#sp_product_id tr').each(function(i){   
        // console.log(10 , 'line discount', $(this).find('td')[10]);         
        // console.log(11, $(this).find('td')[11]);         
        // console.log(12, $(this).find('td')[12]);  
        let line_discount= parseInt($($(this).find('td')[10]).find('input').val())
        let line_gross= parseInt($($(this).find('td')[19]).find('input').val()) //WITHOUT DISCOUNT AND VAT 
        grand_line_total_only_items += line_gross;
        console.log('line 4098', line_discount);
        total_discount += parseInt(line_discount)
        console.log('line 4100', total_discount);
        if($($(this).find('td')[11]).text()){
            price = $($(this).find('td')[11]).text()
            console.log('4129', price);
            price = parseFloat(price)
            console.log('4103', price);
            total_line_vat += parseFloat(price)
            console.log('4105', total_line_vat);
        }
        if($($(this).find('td')[12]).text()){
            price = $($(this).find('td')[12]).text()
            console.log('4109', price);
            // total_line_price += (parseFloat(price) - line_discount)
            total_line_price += parseFloat(price) //LINE TOTAL HAS THE UPDATED VALUE WITH THE DISCOUNT
            console.log('4111', total_line_price);
        }
        console.log('total_line_price', total_line_price);
        console.log('total_line_vat', total_line_vat);
        console.log('total_discount', total_discount);
        $('#total_disc_srsum').html((total_discount).toFixed(2))
        $('#grand_line_total').html((total_line_price).toFixed(2))
        $('#grand_val').html((total_line_vat).toFixed(2))
        $('#grand_total').html((total_line_price).toFixed(2))
        $('#grand_val2').html((total_line_vat).toFixed(2))
        $('#grand_line_total2').html((total_line_price).toFixed(2))
        $('#grand_line_total_only_items').html((grand_line_total_only_items).toFixed(2))
        // console.log(total_line_price)
        
    });         
}

function updateNo(){
    $('#sp_product_id tr').each(function(i){            
        $($(this).find('td')[1]).html(i+1);          
    }); 
}

function removeNotFoundItem(){
    // $('#sp_product_id tr').each(function(i){            
    //     if($($(this).find('td')[2]).html()){
    //         console.log("in if")
    //     }else{
    //         name = $($(this).find('td')[3]).html()
    //         console.log(name)
    //         var NewArray = items.filter(function(element,index,self){
    //             return index === self.indexOf(element); 
    //         });
    //         console.log(NewArray)
    //         $.each(NewArray, function(index, value){
    //           rowdata = value.split("/")
    //           const vala = rowdata[0].replace(/(?:\\[rn])+/g, "")
    //           if($.trim(vala) == name){
    //             items.splice(index,1)
    //           }
    //         })
    //         console.log(items)
    //         $('#excel_data').val(items)
    //         console.log($('#excel_data').val())
    //         tr = $("#"+name).remove()
    //     shoppingCart.removeItemFromCartAll({'name':name});
    //     var rowCount = $('#sp_product_id tr').length;
    //     $('#total_records').html(rowCount)
    //     updateNo()
    //     }
        
    // });

        
    $('#sp_products tbody tr td:contains("Not found")').closest('tr').remove();
    var rowCount = $('#sp_product_id tr').length;
    $('#total_records').html(rowCount);
    updateNo();
}

function inventorytransfer(){
    var val = [];
        $(':checkbox:checked').each(function(i){
          val[i] = $(this).val();
        });
    alert(val)
}

     
</script>
{% endblock %}