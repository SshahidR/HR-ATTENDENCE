


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit VisitingCard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
             font-family: Arial, sans-serif;
             margin: 0;
             
            
         }
    
 
         h1 {
             text-align: start;
             font-size:15px;
         }
 
         .navbar {
             display: flex;
             justify-content: space-between;
             align-items: center;
             height: 50px;
             background-color: #333;
             color: white;
             padding: 10px;
         }
 
         
         .navbar-heading {
             font-size:15px;
             margin-left: 20px;
             font-weight: bold;
         }
 
         .nav-right, .nav-left {
             position: relative;
         }
 
         .nav-left {
             display: flex;
             align-items: center;
         }
 
         .backbtn {
             background-color: inherit;
             color: white;
             font-size: 16px;
             border: none;
             cursor: pointer;
             padding: 10px;
         }
 
         .dropdown {
             position: relative;
             display: inline-block;
         }
 
         .dropbtn {
             background-color: inherit;
             color: white;
             font-size: 16px;
             border: none;
             cursor: pointer;
             padding: 10px;
         }
 
         .tooltip {
             display: none;
             position: absolute;
             top: -5px;
             right: 35px;
             background-color: #555;
             color: white;
             text-align: center;
             border-radius: 6px;
             padding: 5px;
             z-index: 1;
             font-size: 12px;
         }
 
         .nav-right:hover .tooltip {
             display: block;
         }
 
         .input-field, .select-field {
            width: 100%;
            padding: 10px 10px 10px 40px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            color: black;
        }
 
        .select-field {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="6"><path d="M0 0l6 6 6-6z" fill="%23333"/></svg>') no-repeat right 10px center;
            background-size: 12px;
        }
 
        .input-field::placeholder {
            color: black;
        }
        .icon {
             position: absolute;
             left: 10px;
             top: 38px; /* Adjust this value as needed */
             transform: translateY(-50%);
             pointer-events: none;
         }
 
         .error-message {
             color: red;
             font-size: 12px;
             margin-top: 5px;
             position: absolute;
             bottom: -20px; /* Adjust this value as needed */
             left: 0;
         }
 
         .input-group {
             position: relative;
             margin-bottom: 0.5rem; /* Increase this value to accommodate the error message */
         }
         .input-field.error, .select-field.error {
            border-color: red;
         }
 
         .icon i {
             color: black;
             font-size: 14px;
         }
 
         .label {
             margin-bottom: 5px;
             font-weight: bold;
             font-size:12px;
 
         }
 
         .save-button {
             width: 20%;
             padding: 10px;
             border: none;
             background-color: #333;
             color: white;
             font-size: 16px;
             border-radius: 4px;
             cursor: pointer;
             
             margin-bottom: 20px;
         }
 
         .form-label{
             font-size: 13px;
             font-weight: bold;
             margin-bottom: 0.25rem;
            }
            .form-control{
             font-size: 13px;
            }
            .form-select{
             font-size: 13px;
             }
             .mb-3 {
                 margin-bottom: 0.7rem !important;
             }
 
         #snackbar {
             visibility: hidden; 
             width: 350px; 
             height:50px;
             margin-left: -125px; 
             background-color: green;
             color: white; 
             text-align: center; 
             border-radius: 2px; 
             padding: 16px; 
             position: fixed; 
             z-index: 1;
             left: 50%; 
             bottom: 30px; 
           }
 
           #snackbar.error {
             background-color: #f44336; /* Red background for errors */
             color: white;
         }
           
          #snackbar.show {
             visibility: visible;
             
             -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
             animation: fadein 0.5s, fadeout 0.5s 2.5s;
           }
           
          
           .container{
             height:100%;
             width:50%;
             background-color:white;
             margin:20px;
             padding:20px;
           
           }
           .heading{
             font-size:20px;
             text-align:start;
             font-weight:bold;
             padding:10px;
           }
          
     </style>
</head>

<body>
    <div class="container-fluid">
        <nav class="navbar bg-dark text-white">
            <div class="container-fluid">
                <div class="nav-left">
                    <button class="btn btn-link text-white" onclick="navigateBack()"><i
                            class="fas fa-arrow-left"></i></button>
                            <div class="container-fluid">
                                <div class="nav-left">
                                    <h2 class="navbar-heading">Edit Visiting Card</h2>
                                </div>
                </div>
                <div class="nav-right">
                    <!-- <div class="dropdown">
                        <button class="btn btn-link text-white" onclick="navigateToHistory()">â‹®</button>
                        <span class="tooltip">History</span>
                    </div> -->
                </div>
            </div>
        </nav>

   

        <form id="visiting-card-form">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Employee Name</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" id="username" name="username" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                            <input type="email" id="email" name="email" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Designation</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-briefcase"></i></span>
                            <input type="text" id="designation" name="designation" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Mobile Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-phone"></i></span>
                            <input type="tel" id="mobilenum" name="mobilenum" class="form-control" required
                                pattern="[0-9]{10,15}">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Country</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-globe"></i></span>
                            <input type="text" id="country" name="country" class="form-control" required>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">P.O BOX</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                            <input type="text" id="poBox" name="poBox" class="form-control">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Place</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-map-marker-alt"></i></span>
                            <input type="text" id="unitedstate" name="unitedstate" class="form-control" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tel Phone</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-phone"></i></span>
                            <input type="tel" id="telphone" name="telphone" class="form-control">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ext Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-tag"></i></span>
                            <input type="text" id="extnum" name="extnum" class="form-control">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Fax Number</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fa fa-fax"></i></span>
                            <input type="text" id="faxnum" name="faxnum" class="form-control">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12 text-center">
                    <button type="submit" class="save-button" id="updateButton">Update</button>

                </div>
            </div>
        </form>
    </div>

    <div id="snackbar"></div>
    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const authToken = getAuthToken();
            const apiBaseUrl = 'http://127.0.0.1:8000/hr/api';

            function getAuthToken() {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'auth_token') {
                        return decodeURIComponent(value);
                    }
                }
                return null;
            }

            function showLoadingOverlay(duration = 1000) {
                const loadingOverlay = document.getElementById('loading-overlay');
                loadingOverlay.style.display = 'flex';
                return new Promise(resolve => setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                    resolve();
                }, duration));
            }

            function showSnackbar(message, isError = false) {
                return new Promise((resolve) => {
                    const snackbar = document.getElementById('snackbar');
                    snackbar.textContent = message;
                    snackbar.style.backgroundColor = isError ? 'red' : 'green';
                    snackbar.className = 'show';
                    setTimeout(() => {
                        snackbar.className = snackbar.className.replace('show', '');
                        resolve();
                    }, 3000);
                });
            }

            async function fetchVisitingCardDetails() {
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const visitingCardId = urlParams.get('id');

                    if (!visitingCardId) {
                        throw new Error('Missing visiting card ID');
                    }

                    const response = await axios.get(`${apiBaseUrl}/visiting-card-get/${visitingCardId}`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });

                    if (response.status === 200) {
                        const data = response.data;
                        document.getElementById('username').value = data.username;
                        document.getElementById('email').value = data.email;
                        document.getElementById('designation').value = data.designation;
                        document.getElementById('mobilenum').value = data.mobilenum;
                        document.getElementById('country').value = data.Visitingcountry;
                        document.getElementById('poBox').value = data.poBox;
                        document.getElementById('unitedstate').value = data.unitedstate;
                        document.getElementById('telphone').value = data.telphone;
                        document.getElementById('extnum').value = data.extnum;
                        document.getElementById('faxnum').value = data.faxnum;
                    } else {
                        throw new Error('Failed to fetch visiting card details');
                    }
                } catch (error) {
                    console.error('Error fetching visiting card details:', error);
                    await showSnackbar('Error fetching visiting card details: ' + error.message, true);
                }
            }

            async function updateVisitingCardData(event) {
                event.preventDefault();
                const loadingPromise = showLoadingOverlay(2000);

                const urlParams = new URLSearchParams(window.location.search);
                const visitingCardId = urlParams.get('id');

                if (!visitingCardId) {
                    await loadingPromise;
                    await showSnackbar('Error: Missing visiting card ID', true);
                    return;
                }

                const formData = {
                    'username': document.getElementById('username').value,
                    'email': document.getElementById('email').value,
                    'designation': document.getElementById('designation').value,
                    'mobilenum': document.getElementById('mobilenum').value,
                    'Visitingcountry': document.getElementById('country').value, // Changed from 'country' to 'Visitingcountry'
                    'poBox': document.getElementById('poBox').value,
                    'unitedstate': document.getElementById('unitedstate').value,
                    'telphone': document.getElementById('telphone').value,
                    'extnum': document.getElementById('extnum').value,
                    'faxnum': document.getElementById('faxnum').value,
                };

                try {
                    const response = await axios.put(`${apiBaseUrl}/visiting-card-update/${visitingCardId}`, formData, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json',
                        }
                    });

                    await loadingPromise;

                    if (response.status === 200) {
                        await showSnackbar('Visiting card updated successfully');
                        // Navigate to the visiting card history page
                        window.location.href = '/hr/Visiting/visitngCardHistory';
                    } else {
                        throw new Error('Failed to update visiting card');
                    }

                } catch (error) {
                    await loadingPromise;
                    console.error('Error updating visiting card data:', error);
                    await showSnackbar('Error updating visiting card data: ' + error.message, true);
                }
            }

            document.getElementById('visiting-card-form').addEventListener('submit', updateVisitingCardData);

            fetchVisitingCardDetails();
        });

        function navigateBack() {
            window.history.back();
        }

        function navigateToHistory() {
            const urlParams = new URLSearchParams(window.location.search);
            const visitingCardId = urlParams.get('id');
            if (visitingCardId) {
                window.location.href = `/hr/Visiting/visitngCardHistory`;
            } else {
                console.error('Missing visiting card ID');
            }
        }

        function navigateToHistory() {
            window.location.href = '/hr/Visiting/visitngCardHistory';
        }

    </script>
</body>

</html>